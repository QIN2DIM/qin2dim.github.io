<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在 Hugo 中添加 utterances 博客评论系统"><title>『 Hugo 』Blog Comments System</title>
<link rel=canonical href=https://qin2dim.github.io/p/blog-comments-system/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="『 Hugo 』Blog Comments System">
<meta property="og:description" content="在 Hugo 中添加 utterances 博客评论系统">
<meta property="og:url" content="https://qin2dim.github.io/p/blog-comments-system/">
<meta property="og:site_name" content="Echosec @QIN2DIM">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Hugo"><meta property="article:tag" content="Github Pages"><meta property="article:tag" content="blog"><meta property="article:published_time" content="2021-09-20T19:38:45+08:00"><meta property="article:modified_time" content="2021-09-20T19:38:45+08:00"><meta property="og:image" content="https://qin2dim.github.io/p/blog-comments-system/keyboard-648440_1920.jpg">
<meta name=twitter:site content="@Alkaid20860233">
<meta name=twitter:creator content="@Alkaid20860233"><meta name=twitter:title content="『 Hugo 』Blog Comments System">
<meta name=twitter:description content="在 Hugo 中添加 utterances 博客评论系统"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://qin2dim.github.io/p/blog-comments-system/keyboard-648440_1920.jpg">
<link rel="shortcut icon" href=https://image.shutterstock.com/image-vector/hand-drawn-blue-pink-vector-600w-426392518.jpg>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9XVBFK3RRV"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9XVBFK3RRV',{anonymize_ip:!1})}</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=https://qin2dim.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/p/blog-comments-system/>
<img src=/p/blog-comments-system/keyboard-648440_1920_hu955718f9ea4266afcc67e5e6a764f88f_201168_800x0_resize_q75_box.jpg srcset="/p/blog-comments-system/keyboard-648440_1920_hu955718f9ea4266afcc67e5e6a764f88f_201168_800x0_resize_q75_box.jpg 800w, /p/blog-comments-system/keyboard-648440_1920_hu955718f9ea4266afcc67e5e6a764f88f_201168_1600x0_resize_q75_box.jpg 1600w" width=800 height=533 loading=lazy alt="Featured image of post 『 Hugo 』Blog Comments System">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/hugo/ style=background-color:#7e7a6f;color:#fff>
Hugo
</a>
</header>
<h2 class=article-title>
<a href=/p/blog-comments-system/>『 Hugo 』Blog Comments System</a>
</h2>
<h3 class=article-subtitle>
在 Hugo 中添加 utterances 博客评论系统
</h3>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 20, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
阅读时长: 8 分钟
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=overview>Overview</h2>
<p>本篇博客分享如何在 <a class=link href=https://github.com/gohugoio/hugo target=_blank rel=noopener>Hugo</a> 中快速部署 <a class=link href=https://github.com/utterance target=_blank rel=noopener>utteranc</a> 博客评论系统。</p>
<p>此外，作者在压测环境下做了一系列针对该系统的实验。任何你对这个系统可能遇到的极端情况，以及想知道结果但不敢操作的相关行为的代价都详细记录在了文章末尾的 Conclusion中，望有助。</p>
<p>作者所使用的测试环境是 <strong>Hugo/<a class=link href=https://docs.stack.jimmycai.com/zh/configuration/#comments target=_blank rel=noopener>theme:Stack</a> + Github Pages</strong>，使用的环境信息如下：</p>
<table>
<thead>
<tr>
<th style=text-align:center>ID</th>
<th style=text-align:center>Content</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>OS</td>
<td style=text-align:center>Windows</td>
</tr>
<tr>
<td style=text-align:center>hugo version</td>
<td style=text-align:center>hugo v0.88.1-5BC54738+extended</td>
</tr>
<tr>
<td style=text-align:center>hugo theme</td>
<td style=text-align:center>hugo-theme-Stack v3.2.0</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong>： 若您将本篇博客作为您部署 utterances 的参考思路，默认您已具备一个可以正常运作的 Hugo 个人站点。</p>
<h2 id=what-utterances>WHAT utterances</h2>
<p><code>utterances</code> 是一种基于 GitHub issues 构建，可以将 GitHub issues 作为博客评论载体的轻量级评论小部件。截止至2020/09/21，此项目扔拥有以下特性：</p>
<ul>
<li>完全开源</li>
<li>不追踪流量，没有广告，完全免费</li>
<li>不阻断流量，所有的评论数据都会存储在你指定的Repository中</li>
<li>基于<a class=link href=https://primer.style/ target=_blank rel=noopener>Primer</a>设计，这是一种Github官方提供的CSS工具包（相较之下有更好的兼容性和性能提升）</li>
<li>支持暗黑模式（Dark theme）</li>
<li>足够轻量，完美兼容 Markdown 语法，没有字体缓存或 JavaScript frameworks 依赖</li>
</ul>
<h2 id=why-utterances>WHY utterances</h2>
<p>为什么选择<code>utterances</code>？主要原因如上文所示，<code>utterances</code> 是一种基于 Github 生态孵化的足够轻量的部件，在使用同为 Github 产品 Github Pages 的前提下，使用”同源产品“能够方便我们管理资源的储备及分布。此外，”同源“意味着它比其他”第三方“产品具备更好的兼容性及运行效率，从技术选型上符合”足够使用，不需要过度折腾“的普世需求。</p>
<p>此外，对于国内技术用户来说有更大的便捷之处。选择 <code>utterances</code> 作为博客评论系统的多大技术出身，此类技术博客的访客通常也人手一个 Github 账号。因此， Github 一键授权后，“评论发布” 与 “issues 分发” 都将畅通无阻，而非像部分第三方系统，还需使用者注册额外账号获取 Token 并鉴权后才能回复，这样绕一圈非常耗时，可能有的系统站点还被墙了，部分访客无法访问。</p>
<p>当然，还有许多 Github 同源产品，以及一些优秀的第三方产品，这里不过多介绍了。截至目前 Hugo 支持的评论系统对比如下：</p>
<table>
<thead>
<tr>
<th style=text-align:center>Provider</th>
<th style=text-align:center>Github Platform</th>
<th style=text-align:center>Markdown</th>
<th style=text-align:center>Open Source</th>
<th style=text-align:center>No ADs</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>disqus</td>
<td style=text-align:center>❌</td>
<td style=text-align:center>✅</td>
<td style=text-align:center>❌</td>
<td style=text-align:center>❌</td>
</tr>
<tr>
<td style=text-align:center><strong>utterances</strong></td>
<td style=text-align:center>✅</td>
<td style=text-align:center>✅</td>
<td style=text-align:center>✅</td>
<td style=text-align:center>✅</td>
</tr>
<tr>
<td style=text-align:center>remark42</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
<tr>
<td style=text-align:center>vssue</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
<tr>
<td style=text-align:center>waline</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
<tr>
<td style=text-align:center>twikoo</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
<tr>
<td style=text-align:center>giscus</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
<tr>
<td style=text-align:center>gitalk</td>
<td style=text-align:center>✅</td>
<td style=text-align:center></td>
<td style=text-align:center></td>
<td style=text-align:center></td>
</tr>
</tbody>
</table>
<h2 id=how-utterances>HOW utterances</h2>
<h3 id=how-it-works>How it works</h3>
<ul>
<li>
<p><code>utterances</code> 工作流大致如下：</p>
<p>当你的站点首次部署 <code>utterances</code> 时，它会定期（频率很快）扫描你的站点，如果发现有新的留言，会依照对应的规则（title/url/pathname）在你的 <code>comments-repo</code> 里提交 issue 。比如，你选择的规则是 <code>title</code>, 那么你的文章标题会被作为 <code>Issue Title</code> 提交到 <code>comments-repo</code> ；如果你选的规则是 <code>pathname</code>，那么文章对应的访问路径就会成为你的 <code>Issue Title</code>; <code>url</code>同理，只是在<code>pathname</code>前加上了域名标签。</p>
<p>当访客（首次使用 <code>utterances</code> 系统）评论时，需要先进行 Github OAth API 授权，涉及的权限是允许 <code>utterances</code> 控制访客账号向你的 <code>comments-repo</code> 提交留言。</p>
<p>值得一提的是，当你首次成功部署<code>utterances</code>后，它并不会自动扫描你的站点并为你所有的文章都创建一个对应的初始化 issue 发送到你的仓库，它只会监听自它被部署后新出现的评论，如果这个被评论的文章没有提过 issue，才会携带相关信息提交 issue，如果已存在 issue（该篇文章被 <strong>utterances-user</strong> 评论过），则会携带相关信息盖楼（在同 issue 下留言，而非继续创建）。</p>
</li>
<li>
<p>当有访客来到这发表评论时，会经过如下过程：</p>
</li>
</ul>
<p><figure>
<a href=/p/blog-comments-system/utteranc-workflow-16322305582472.svg>
<img src=/p/blog-comments-system/utteranc-workflow-16322305582472.svg loading=lazy alt=utterances-workflow>
</a>
<figcaption>utterances-workflow</figcaption>
</figure></p>
<p>上图 <code>utterances-workflow</code> 提到了几个关键节点：</p>
<ul>
<li>
<p><code>comments-repo</code>：用于存放用户评论信息的仓库</p>
<p>意味着我们需要创建一个 Repository 存放 blog comments</p>
</li>
<li>
<p><code>utterances-bot</code>：用于处理其他 Github 用户提交的 comment</p>
<p>意味着我们需要在这个 Repository ( <code>comments-repo</code> ) 中下载 <code>utterances</code>，包含授权以及机器人一条龙管家服务。</p>
</li>
</ul>
<h3 id=how-to-use-utterances-on-hugo>How to use utterances on Hugo</h3>
<ul>
<li>
<p>New a Public Repository, such as &lsquo;comments-repo&rsquo;.</p>
</li>
<li>
<p>Change the configuration of your Hugo site-code.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=c># ~/config.yaml </span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># 再次声明，本博客使用 Stack 主题作为分享参考，此主题使用.yaml 格式配置文件，且预先写好了 utterances 接口网页，意味着仅需改动配置文件就能使用。</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># 如果你至此的所有环境与操作都与作者相同，那恭喜你马上就要通关了！</span><span class=w>
</span><span class=w></span><span class=c># 如果你的主题用其他格式文件，注意语法的调整。</span><span class=w>
</span><span class=w></span><span class=c># 如果你的主题没有携带 utterances 脚本代码，请在~/layouts/partials/comments/provider/ 目录下新建一个 utterances.html 文件，并在里面输入下一个代码块中的内容。如何判断你的主题是否支持 utterances 呢？ 查看 ~/themes/&lt;your-theme&gt;/layouts/partials/comments/provider/ 目录下是否存在 utterances.html 既可。</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=c># 全局配置</span><span class=w>
</span><span class=w></span><span class=nt>params</span><span class=p>:</span><span class=w>
</span><span class=w>   </span><span class=c># 留言系统设置</span><span class=w>
</span><span class=w>    </span><span class=nt>comments</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>        </span><span class=c># 评论系统提供商。目前支持的有：disqus utterances remark42 vssue waline twikoo giscus gitalk</span><span class=w>
</span><span class=w>        </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>utterances</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=c># 关于 utterances 的具体配置</span><span class=w>
</span><span class=w>        </span><span class=nt>utterances</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=c># repo 必填项，指向你的`comments-repo`，参照写法如 qin2dim/blog-comments 注意别加.github.io</span><span class=w>
</span><span class=w>          </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=l>&lt;GithubUserName&gt;/&lt;RepositoryName&gt;</span><span class=w>
</span><span class=w>
</span><span class=w>          </span><span class=c># issueTerm: 必填项，issue标题的切分规则，可写 pathname title url</span><span class=w>
</span><span class=w>          </span><span class=nt>issueTerm</span><span class=p>:</span><span class=w> </span><span class=l>pathname</span><span class=w>
</span><span class=w>
</span><span class=w>          </span><span class=c># theme 必填项，评论区的主题</span><span class=w>
</span><span class=w>          </span><span class=c># 可选 github-light github-dark preferred-color-scheme </span><span class=w>
</span><span class=w>          </span><span class=c># github-dark-origin lcy-dark dark-blue photon-dark boxy-light</span><span class=w>
</span><span class=w>          </span><span class=nt>theme</span><span class=p>:</span><span class=w> </span><span class=l>github-light</span><span class=w>
</span><span class=w>
</span><span class=w>          </span><span class=c># label 可选项，提交的issue的默认标签，不填则不打标签。</span><span class=w>
</span><span class=w>          </span><span class=nt>label</span><span class=p>:</span><span class=w> 
</span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html>// utterances.html template of theme, Stack

<span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://utteranc.es/client.js&#34;</span> 
        <span class=na>repo</span><span class=o>=</span><span class=s>&#34;{{ .Site.Params.comments.utterances.repo }}&#34;</span>
        <span class=na>issue-term</span><span class=o>=</span><span class=s>&#34;{{ .Site.Params.comments.utterances.issueTerm }}&#34;</span>
        <span class=err>{{</span> <span class=na>with</span> <span class=err>.</span><span class=na>Site</span><span class=err>.</span><span class=na>Params</span><span class=err>.</span><span class=na>comments</span><span class=err>.</span><span class=na>utterances</span><span class=err>.</span><span class=na>label</span> <span class=err>}}</span>
        <span class=na>label</span><span class=o>=</span><span class=s>&#34;{{ . }}&#34;</span>
        <span class=err>{{</span> <span class=na>end</span> <span class=err>}}</span>
        <span class=na>crossorigin</span><span class=o>=</span><span class=s>&#34;anonymous&#34;</span>
        <span class=na>async</span>
        <span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>

<span class=p>&lt;</span><span class=nt>style</span><span class=p>&gt;</span>
    <span class=p>.</span><span class=nc>utterances</span> <span class=p>{</span>
        <span class=k>max-width</span><span class=p>:</span> <span class=kc>unset</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>

<span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
    <span class=kd>function</span> <span class=nx>setUtterancesTheme</span><span class=p>(</span><span class=nx>theme</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>let</span> <span class=nx>utterances</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;.utterances iframe&#39;</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>utterances</span><span class=p>)</span> <span class=p>{</span>
            <span class=nx>utterances</span><span class=p>.</span><span class=nx>contentWindow</span><span class=p>.</span><span class=nx>postMessage</span><span class=p>(</span>
                <span class=p>{</span>
                    <span class=nx>type</span><span class=o>:</span> <span class=s1>&#39;set-theme&#39;</span><span class=p>,</span>
                    <span class=nx>theme</span><span class=o>:</span> <span class=sb>`github-</span><span class=si>${</span><span class=nx>theme</span><span class=si>}</span><span class=sb>`</span>
                <span class=p>},</span>
                <span class=s1>&#39;https://utteranc.es&#39;</span>
            <span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=nx>event</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>origin</span> <span class=o>!==</span> <span class=s1>&#39;https://utteranc.es&#39;</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
        <span class=nx>setUtterancesTheme</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>documentElement</span><span class=p>.</span><span class=nx>dataset</span><span class=p>.</span><span class=nx>scheme</span><span class=p>)</span>
    <span class=p>});</span>

    <span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;onColorSchemeChange&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
        <span class=nx>setUtterancesTheme</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>detail</span><span class=p>)</span>
    <span class=p>})</span>
<span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</code></pre></div></li>
<li>
<p>Install utterances for your &lsquo;comments-repo&rsquo; .</p>
<p>访问 <a class=link href=https://github.com/apps/utterances target=_blank rel=noopener>utterances</a> 为你的仓库下载执行脚本。切记仅对你存储评论的仓库下载脚本（Only select repositories）。</p>
</li>
<li>
<p>Git the utterances-bot to operate your &lsquo;comments-repo&rsquo;.</p>
<p>再次访问 <a class=link href=https://github.com/apps/utterances target=_blank rel=noopener>utterances</a> 授予机器人操作仓库的权限（Configure）。</p>
</li>
<li>
<p>Enjoy your live.</p>
<p>本地启动 Hugo 服务器，或者推送启动了评论功能的站点代码，直接访问你的 Github Pages，测试评论功能。</p>
<p><img src=image-20210921221634558.png style=zoom:50%></p>
</li>
</ul>
<h2 id=conclusion>Conclusion</h2>
<ul>
<li>
<p><strong>本地 hugo server 提交的评论也会被 utterances-bot 收录到 issues 中</strong></p>
<p><figure class=gallery-image style=flex-grow:191;flex-basis:458px>
<a href=/p/blog-comments-system/image-20210921222542719.png data-size=2015x1054>
<img src=/p/blog-comments-system/image-20210921222542719.png width=2015 height=1054 srcset="/p/blog-comments-system/image-20210921222542719_hud5dc7da48c84aefbe260857398577f80_237619_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210921222542719_hud5dc7da48c84aefbe260857398577f80_237619_1024x0_resize_box_3.png 1024w" loading=lazy alt=Comments-repo>
</a>
<figcaption>Comments-repo</figcaption>
</figure></p>
</li>
<li>
<p><strong>直接在 issues 中发送的留言，也被会 utterances-bot 转发到 issues 对应的博客评论区中</strong></p>
<p>值得一提的是，如果你此时正在本地运行 hugo server，有人在 issue 中发送新的留言，你能直接在 local server 中接收到这个信息，意味着你的文章评论区会直接渲染出更新的内容（如果你是 fast render 模式，需要刷新一下页面）。 同理，已经部署发布的站点也能收到这些讯息（实时更新）。</p>
<p><img src=image-20210921223843970.png alt=image-20210921223843970 style=zoom:67%></p>
</li>
<li>
<p><strong>从 utterances-bot 被成功部署的时刻算起，被评论过的文章才会被映射成 issue 收录进 comments-repository 中</strong></p>
</li>
<li>
<p><strong>作为仓库的创建者，你有权删除任何 issue</strong></p>
<p>一个已创建的评论 issue 后被删除，其盖楼评论会一起消失，意味着 issue 对应博客下的所有评论都会被瞬间清空。</p>
</li>
<li>
<p><strong>作为仓库的创建者，你有权 close/reopen 任何 issue，但这并不影响评论系统的正常运转</strong></p>
<p>如下图所示，作者先手动关闭了一个评论 issue，观察到稍后在博客中的留言依然可以被转发进来。此时 issue 仍保持<code>close</code>状态，并不会因为有新的动态而<code>reopen</code>。</p>
<p><figure class=gallery-image style=flex-grow:135;flex-basis:325px>
<a href=/p/blog-comments-system/image-20210921230424682.png data-size=1484x1093>
<img src=/p/blog-comments-system/image-20210921230424682.png width=1484 height=1093 srcset="/p/blog-comments-system/image-20210921230424682_hu1e9cf67bbeff687ab88bdea8c44593ef_132420_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210921230424682_hu1e9cf67bbeff687ab88bdea8c44593ef_132420_1024x0_resize_box_3.png 1024w" loading=lazy alt="B signal from hugo server">
</a>
<figcaption>B signal from hugo server</figcaption>
</figure></p>
<p>同样，从<code>closed issue</code>中发的言论，仍会被同步到 issue 对应的博客评论区中，如下图所示。</p>
<p><figure class=gallery-image style=flex-grow:332;flex-basis:798px>
<a href=/p/blog-comments-system/image-20210921230722030.png data-size=2708x814>
<img src=/p/blog-comments-system/image-20210921230722030.png width=2708 height=814 srcset="/p/blog-comments-system/image-20210921230722030_hu5cb2465af768e815f71b2160a2c767b6_220402_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210921230722030_hu5cb2465af768e815f71b2160a2c767b6_220402_1024x0_resize_box_3.png 1024w" loading=lazy alt="A signal from closed issue">
</a>
<figcaption>A signal from closed issue</figcaption>
</figure></p>
</li>
<li>
<p><strong>从 issue 中被删去的留言，在 issue 对应文章的评论区中的留言也会被同步删除</strong></p>
<p>但是在博客中确无法找到删除留言的元素，意味着博客留言者想要移除/修改自己已发表的评论，需要到 comments-repo 仓库这里修改。</p>
</li>
<li>
<p><strong>映射网址无法自动调整</strong></p>
<ul>
<li>
<p>还记得Conclusion 的第一条总结吗，机器人会提供一条反射信息，是一个直接指向该篇博客的访问链接。通常情况下这时正常运作的，但如果这篇文章的第一条评论是你在本地测试时直接在 hugo server 上发送的，那反射信息就会如图中显示的那样指向http:localhost:1313/xxx，这是一个非常糟糕的情况，后续作者在部署站点上更新的评论，依然无法让机器人自动调整反射网址。如果你这么做了，你可能手动修改issue中的反射信息，否则他无法指向正确的博客链接。</p>
</li>
<li>
<p>机器人提供的反射域名并不会因为你设置了CNAME而有所改变，依然会是<code>https://Yourname.github.io/xxxx</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>utterances 具备一定的“跟踪”能力</strong></p>
<ul>
<li>
<p>如第一条 Conclusion 所示，当你的文章被标记收录后，机器人会提供你的文章标题以及副标题信息。即使你未来改变了这些信息（title，description），issue中的已被提供的这些信息不会自行变更，但这并不影响评论系统正常运行。</p>
</li>
<li>
<p>但如果你修改了文章的<code>slug</code>也即修改了文章对应的检索路径（重启本地服务器后生效），这篇文章挂载的评论信息会“丢失”。同样，你在更新了 slug 的文章发送的评论，会被机器人以新的 issue 提交到你的 comments-repo，显然，首层占楼的反射信息指向了你变更后的博客网址。</p>
<p><figure class=gallery-image style=flex-grow:261;flex-basis:627px>
<a href=/p/blog-comments-system/image-20210921234029895.png data-size=777x297>
<img src=/p/blog-comments-system/image-20210921234029895.png width=777 height=297 srcset="/p/blog-comments-system/image-20210921234029895_hu1bd586458df5d8d6ae2be592aa6608b3_36524_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210921234029895_hu1bd586458df5d8d6ae2be592aa6608b3_36524_1024x0_resize_box_3.png 1024w" loading=lazy alt="Issues of the comments-repo">
</a>
<figcaption>Issues of the comments-repo</figcaption>
</figure><figure class=gallery-image style=flex-grow:190;flex-basis:457px>
<a href=/p/blog-comments-system/image-20210921234644893.png data-size=774x406>
<img src=/p/blog-comments-system/image-20210921234644893.png width=774 height=406 srcset="/p/blog-comments-system/image-20210921234644893_hudbd65d4969dde2f3d85137308f6c050d_41588_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210921234644893_hudbd65d4969dde2f3d85137308f6c050d_41588_1024x0_resize_box_3.png 1024w" loading=lazy alt="YAML Font Matter of Markdown">
</a>
<figcaption>YAML Font Matter of Markdown</figcaption>
</figure></p>
</li>
</ul>
</li>
<li>
<p><strong>utterances 跟踪你的网址而非你的标题</strong></p>
<p>是的，猜想是对的。当你将文章的<code>slug</code>改回去后，这篇文章所挂载的评论区又回来了。意味着只要不删除 issue，评论信息并不会真正 &ldquo;丢失&rdquo;。</p>
<p>换句话说，你可以随意修改文章标题以及副标题，但不要随意修改文章的网页路径<code>slug</code>，这是一项危险的操作，除非你做好了数据迁移的准备。</p>
</li>
<li>
<p>在 comments-repo 中人为提交的 issue 会作为评论被同步到对应的文章中吗？</p>
<p>答：不可以！但是，只有第一条不可以！</p>
<p>以下为一条规则正确的 issue ，他被正确指向作者的“Hello Hugo”这篇博客，创建 issue 时发送了一局“Could you do it?”在博客评论区中没有提现。而后作者在同个评论区中发言“:rocket: Can you make it?” 却能经过转发，体现在 issue 中，可以看到作者头像右下角出现了 utterances 的标志。之后，作者在 issue 中连续发送的两条消息都能被转发到博客评论区中。</p>
<p><figure class=gallery-image style=flex-grow:224;flex-basis:538px>
<a href=/p/blog-comments-system/image-20210922003310596.png data-size=1014x452>
<img src=/p/blog-comments-system/image-20210922003310596.png width=1014 height=452 srcset="/p/blog-comments-system/image-20210922003310596_hu981c248986aad23bed7f866441828a2e_53573_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210922003310596_hu981c248986aad23bed7f866441828a2e_53573_1024x0_resize_box_3.png 1024w" loading=lazy>
</a>
</figure><figure class=gallery-image style=flex-grow:228;flex-basis:548px>
<a href=/p/blog-comments-system/image-20210922003342805.png data-size=925x405>
<img src=/p/blog-comments-system/image-20210922003342805.png width=925 height=405 srcset="/p/blog-comments-system/image-20210922003342805_huc15c305d86fce6746c1b59d0c14683d5_33040_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210922003342805_huc15c305d86fce6746c1b59d0c14683d5_33040_1024x0_resize_box_3.png 1024w" loading=lazy>
</a>
</figure></p>
</li>
</ul>
<p><figure class=gallery-image style=flex-grow:159;flex-basis:382px>
<a href=/p/blog-comments-system/image-20210922004416298.png data-size=1740x1092>
<img src=/p/blog-comments-system/image-20210922004416298.png width=1740 height=1092 srcset="/p/blog-comments-system/image-20210922004416298_hueac024d129ac77b04b71d418a6c4c7c6_286614_480x0_resize_box_3.png 480w, /p/blog-comments-system/image-20210922004416298_hueac024d129ac77b04b71d418a6c4c7c6_286614_1024x0_resize_box_3.png 1024w" loading=lazy alt=被动通信>
</a>
<figcaption>被动通信</figcaption>
</figure></p>
<h2 id=reference>Reference</h2>
<ul>
<li>
<p><a class=link href="https://utterances.es/?installation_id=19642746&setup_action=install" target=_blank rel=noopener>utterances</a></p>
</li>
<li>
<p><a class=link href=https://github.com/utterance target=_blank rel=noopener>utterances (github.com)</a></p>
</li>
<li>
<p><a class=link href=https://gohugo.io/ target=_blank rel=noopener>The world’s fastest framework for building websites | Hugo (gohugo.io)</a></p>
</li>
<li>
<p><a class=link href=https://docs.stack.jimmycai.com/zh/configuration/#comments target=_blank rel=noopener>配置主题 | Hugo 主题 Stack (jimmycai.com)</a></p>
</li>
</ul>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/hugo/>Hugo</a>
<a href=/tags/github-pages/>Github Pages</a>
<a href=/tags/blog/>Blog</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>相关文章</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/p/typlog-atlas/>
<div class=article-image>
<img src=/p/typlog-atlas/topic.ba3827d8b9ae2d9f769ba6f3a9410edb_hu0b47b138f493b3f6e0d84b750117d30b_2670061_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key=typlog-atlas data-hash="md5-ujgn2LmuLZ92m6bzqUEO2w==">
</div>
<div class=article-details>
<h2 class=article-title>『 Hugo 』Typlog Atlas</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/p/hello-hugo/>
<div class=article-image>
<img src=/p/hello-hugo/coffee-2511065_1920.c7bff0845cf145339ca52f0dc679c995_hu542c575640116087aad91130e63312e2_586804_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy data-key=hello-hugo data-hash="md5-x7/whFzxRTOcpS8NxnnJlQ==">
</div>
<div class=article-details>
<h2 class=article-title>『 Hugo 』Hello Hugo</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/p/hugo-shortcode/>
<div class=article-image>
<img src=/p/hugo-shortcode/_hu7ec305cdcf86252b086b494c826c41f9_291916_cdf2ec0f1e7679201f3240ea8f21622f.jpg width=250 height=150 loading=lazy data-key data-hash="md5-k7EzXrfYrmugFTcwgIWmCg==">
</div>
<div class=article-details>
<h2 class=article-title>『 Hugo 』Shortcode</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<script src=https://utteranc.es/client.js repo=qin2dim/blog-comments issue-term=pathname crossorigin=anonymous async></script>
<style>.utterances{max-width:unset}</style>
<script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2021 Echosec @QIN2DIM
</section>
<section class=powerby>
You will to enjoy grander sight / By climing to a greater height. <br>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">目录</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#overview>Overview</a></li>
<li><a href=#what-utterances>WHAT utterances</a></li>
<li><a href=#why-utterances>WHY utterances</a></li>
<li><a href=#how-utterances>HOW utterances</a>
<ol>
<li><a href=#how-it-works>How it works</a></li>
<li><a href=#how-to-use-utterances-on-hugo>How to use utterances on Hugo</a></li>
</ol>
</li>
<li><a href=#conclusion>Conclusion</a></li>
<li><a href=#reference>Reference</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>