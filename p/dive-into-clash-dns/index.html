<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æ·±å…¥æµ…å‡ºåœ°ä»‹ç» Clash DNS çš„å·¥ä½œåŸç†"><title>ã€Blogã€Dive into Clash DNS</title><link rel=canonical href=https://blog.echosec.top/p/dive-into-clash-dns/><link rel=stylesheet href=/scss/style.min.00066413cf5b11ff83f68f901cd98368c0b2d6327b373ddf957666a5c4d92db2.css><meta property="og:title" content="ã€Blogã€Dive into Clash DNS"><meta property="og:description" content="æ·±å…¥æµ…å‡ºåœ°ä»‹ç» Clash DNS çš„å·¥ä½œåŸç†"><meta property="og:url" content="https://blog.echosec.top/p/dive-into-clash-dns/"><meta property="og:site_name" content="Echosec @QIN2DIM"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="clash"><meta property="article:tag" content="clash-meta"><meta property="article:tag" content="clash-verge"><meta property="article:tag" content="clash-dns"><meta property="article:tag" content="dns-router"><meta property="article:tag" content="fakeip"><meta property="article:tag" content="fakedns"><meta property="article:published_time" content="2023-07-15T12:17:57+08:00"><meta property="article:modified_time" content="2023-07-15T12:17:57+08:00"><meta property="og:image" content="https://blog.echosec.top/p/dive-into-clash-dns/dominik-mayer.jpg"><meta name=twitter:site content="@Alkaid20860233"><meta name=twitter:creator content="@Alkaid20860233"><meta name=twitter:title content="ã€Blogã€Dive into Clash DNS"><meta name=twitter:description content="æ·±å…¥æµ…å‡ºåœ°ä»‹ç» Clash DNS çš„å·¥ä½œåŸç†"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.echosec.top/p/dive-into-clash-dns/dominik-mayer.jpg"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/qin2dim/cdn-relay@main/avatars/watercolour-4817390__480.jpg><script async src="https://www.googletagmanager.com/gtag/js?id=G-9XVBFK3RRV"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9XVBFK3RRV",{anonymize_ip:!1})}</script><link rel=stylesheet href=//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css><script async src=https://busuanzi.icodeq.com/busuanzi.pure.mini.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/62018067_hu01b1850304f2a433574ed2470395348a_321911_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¯</span></figure><div class=site-meta><h1 class=site-name><a href=/>Echosec @QIN2DIM</a></h1><h2 class=site-description>A Creator from China.</h2></div></header><ol class=social-menu><li><a href=https://github.com/QIN2DIM target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com/Tk206_ target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://nav.echosec.top target=_blank title=Navigator><!doctype html><svg t="1635028836276" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="9207" width="128" height="128" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style/></defs><path d="M782.802 129.086c3.079.0 5.884 2.805 5.884 5.884v744.58L561.591 601.177 512 540.387l-49.591 60.789-227.095 278.375v-744.58c0-3.08 2.805-5.884 5.884-5.884h541.604m0-64.001H241.198c-38.436.0-69.884 31.448-69.884 69.884v768.729c.276 33.712 27.781 55.214 56.065 55.214 15.368.0 30.969-6.353 42.548-20.546L512 641.633 753.023 937.08c11.68 14.317 27.793 20.773 43.661 20.773 28.115.0 55.458-20.27 55.993-53.003.006-.383.009-.767.009-1.151V134.971c0-38.437-31.447-69.885-69.884-69.885z" p-id="9208" fill="#bababa"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/links><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/dive-into-clash-dns/><img src=/p/dive-into-clash-dns/dominik-mayer_hu5839e53c54117c6791a00e83defa26e6_1229585_800x0_resize_q75_box.jpg srcset="/p/dive-into-clash-dns/dominik-mayer_hu5839e53c54117c6791a00e83defa26e6_1229585_800x0_resize_q75_box.jpg 800w, /p/dive-into-clash-dns/dominik-mayer_hu5839e53c54117c6791a00e83defa26e6_1229585_1600x0_resize_q75_box.jpg 1600w" width=800 height=497 loading=lazy alt="Featured image of post ã€Blogã€Dive into Clash DNS"></a></div><div class=article-details><header class=article-category><a href=/categories/software-engineering/ style=background-color:#cfb887;color:#fff>Software Engineering</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/dive-into-clash-dns/>ã€Blogã€Dive into Clash DNS</a></h2><h3 class=article-subtitle>æ·±å…¥æµ…å‡ºåœ°ä»‹ç» Clash DNS çš„å·¥ä½œåŸç†</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2023-07-15</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 21 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=ç®€ä»‹>ç®€ä»‹</h2><p>é€è¡Œé˜…è¯»æºç ï¼Œè¶…ï¼ç¡¬ï¼æ ¸ï¼çš„ Clash DNS åº•å±‚åŸç†è¯¦è§£ï¼</p><p>ï¼ˆincoming&mldr;ï¼‰</p><h2 id=å®éªŒç¯å¢ƒ>å®éªŒç¯å¢ƒ</h2><div class=table-wrapper><table><thead><tr><th style=text-align:left>æ“ä½œç³»ç»Ÿ</th><th style=text-align:left>Windows 11</th></tr></thead><tbody><tr><td style=text-align:left>ç³»ç»ŸDNS</td><td style=text-align:left>192.168.31.1</td></tr><tr><td style=text-align:left>ç½‘å…³IP</td><td style=text-align:left>192.168.31.1</td></tr><tr><td style=text-align:left>å­ç½‘IP</td><td style=text-align:left>192.168.31.178</td></tr><tr><td style=text-align:left>ä»£ç†æ ¸å¿ƒ</td><td style=text-align:left><a class=link href=https://github.com/MetaCubeX/Clash.Meta/releases/tag/v1.15.0 target=_blank rel=noopener>Clash.Meta v1.15.0</a></td></tr><tr><td style=text-align:left>å¼•å¯¼UI</td><td style=text-align:left><a class=link href=https://github.com/zzzgydi/clash-verge/releases/tag/v1.3.3 target=_blank rel=noopener>clash-verge v1.3.3</a></td></tr></tbody></table></div><ol><li><p>Protocol: tuic v5</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>proxies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- {<span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;tunic&#34;</span><span class=nt>, type: tuic, udp-relay-mode: quic, congestion-controller: bbr, alpn: [&#39;h3&#39;, &#39;spdy/3.1&#39;], reduce-rtt: True, max-udp-relay-packet-size: 1464, server: *, port: *, uuid: *, password: *, ip</span><span class=p>:</span><span class=w> </span>*<span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>proxy-groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- {<span class=w> </span><span class=nt>name: PROXY, type: select, proxies</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;tunic&#34;</span><span class=p>]</span><span class=w> </span>}<span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>RULE-SET æ¥è‡ªè§„åˆ™ä¸Šæ¸¸ <em>Loyalsoldier/clash-rules</em></p><p>å½“æ­£æ–‡ä¸­æ²¡æœ‰æ˜ç¡®è¯´æ˜ rules æ—¶ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rule-providers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># -- skip --</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,applications,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,cn,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,private,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,clash.razord.top,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,yacd.haishan.me,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,services.googleapis.cn,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,reject,REJECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,direct,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,private,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,proxy,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,icloud,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,apple,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,lancidr,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,cncidr,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>RULE-SET,telegramcidr,PROXY,no-resolve</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,PRIVATE,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=å®éªŒæ–¹æ³•>å®éªŒæ–¹æ³•</h2><blockquote><p>ğŸ¦‰å®éªŒå¯å®‰å…¨å¤ç°</p></blockquote><ol><li><p>åˆ†åˆ«åœ¨è§„åˆ™æ¨¡å¼ï¼Œå…¨å±€æ¨¡å¼ï¼Œç›´è¿æ¨¡å¼ä¸‹ä½¿ç”¨é¢„å®šä¹‰çš„ <code>dns</code> å®éªŒé…ç½®è®¿é—®åŸŸåï¼š</p><ul><li><p><code>api.dida365.com</code></p><p>å‘½ä¸­è§„åˆ™ <code>geosite:cn</code></p></li><li><p><code>api.dida36768990.com</code></p><p>ä¸€ä¸ªéšä¾¿æ•²çš„åŸŸåï¼Œå‡è®¾å®ƒä¸å­˜åœ¨ã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸ªä¸å­˜åœ¨äºå„ä¸ª RULE-SET ä¸­çš„ targetã€‚</p></li><li><p><code>www.google.com</code></p><p>ä»ä¸Šè‡³ä¸‹ï¼Œå‘½ä¸­é¦–æ¡åŸŸåä»£ç†è§„åˆ™ã€‚</p></li></ul></li><li><p>åˆ‡æ¢åˆ° TUN æ¨¡å¼å†æµ‹ä¸€é</p></li><li><p>Recode DNS configuration, logger, wireshark trace</p><p>è®°å½•è¯·æ±‚çš„è§¦å‘é¡ºåºï¼Œé˜è¿° clash DNS é€šä¿¡çš„åº•å±‚é€»è¾‘ã€‚</p></li><li><p>æ— ç‰¹æ®Šè¯´æ˜ç»Ÿä¸€ä½¿ç”¨ clash ä»£ç§° Clash å’Œ Clash.Meta</p></li><li><p>å®éªŒåœ¨ Win PC æ‰§è¡Œï¼Œè€Œéè½¯è·¯ç”±ç­‰åµŒå…¥å¼è®¾å¤‡</p></li><li><p>æ¯è½®å®éªŒç»“æŸåæ¸…é™¤æ‰€æœ‰ clash è¿æ¥ï¼Œ <code>ipconfig \flushdns</code> æ¸…é™¤ DNS ç¼“å­˜</p></li><li><p>å®éªŒä¸­ä½¿ç”¨ clash-verge å¼•å¯¼ Clash.Meta ä»£ç†æ ¸å¿ƒï¼ŒUI ä¿æŒå‡ºå‚è®¾å®š</p></li></ol><hr><blockquote><p>ğŸª–éœ€è¦æ³¨æ„ï¼šClash DNS Object æœ‰åˆå§‹å€¼ï¼Œclash ä¼šç”¨ç¡¬ç¼–ç çš„åˆå§‹åŒ–å‚æ•°è¦†ç›–æˆ‘ä»¬ç¼ºçœçš„å­—æ®µï¼Œå…·ä½“é»˜è®¤å€¼å¯çœ‹ä¸Šæ–‡çš„ <a class=link href>DNS é»˜è®¤é…ç½®</a> ä»¥åŠ <a class=link href>UnmarshalRawConfig</a>ã€‚</p></blockquote><p>å®éªŒæŒ‰ä»¥ä¸‹æ¨¡å—ä¾æ¬¡è¡Œè¿›ï¼š</p><ol><li>config.yaml ä¸­çš„ dns é…ç½®å­—æ®µ</li><li>wireshark æŠ“åŒ…ï¼Œè¿‡æ»¤æ¡ä»¶æ˜¯ <code>dns && ip.dst==192.168.31.178</code></li><li>è¿æ¥æ—¥å¿—ï¼ˆå¯çœç•¥ï¼‰</li></ol><h2 id=é…ç½®ç¯‡>é…ç½®ç¯‡</h2><h3 id=å¼•å…¥-default-nameserver--nameserver>å¼•å…¥ default-nameserver & nameserver</h3><blockquote><p>ğŸ’¡å‰è€…ç”¨äºè§£æåè€…çš„åŸŸåï¼Œåè€…ç”¨äºè§£ææˆ‘ä»¬è¦è®¿é—®çš„åŸŸåã€‚</p></blockquote><h4 id=è§„åˆ™æ¨¡å¼---å¯¹ç…§ç»„--é»˜è®¤é…ç½®>è§„åˆ™æ¨¡å¼ - å¯¹ç…§ç»„ | é»˜è®¤é…ç½®</h4><p>ä»…è®¾ç½® <em>enable</em> å­—æ®µï¼Œæ­¤æ—¶é‡‡ç”¨<a class=link href="https://www.notion.so/Dive-into-Clash-DNS-a025c9bb5f724972a2ffb7984ae4a6ca?pvs=21" target=_blank rel=noopener>åˆå§‹åŒ–çš„ DNS é…ç½®</a>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒå…ˆå¹¶å‘è¯·æ±‚ default-nameserver ä¸­é…ç½®çš„å››æ¡ DNS IP å»è§£æ <code>doh.pub</code> ï¼ˆå†ä½¿ç”¨ <code>https://doh.pub/dns-query</code> è¿™æ¡ DOH <em>nameserver</em> é…ç½®å»è§£æ <code>api.dida365.com</code>ï¼‰ã€‚</p><p>DOH è¡Œè¿›æ—¶ï¼ŒåŸŸåæŸ¥è¯¢è¢«å°è£…åœ¨ HTTPS è¯·æ±‚ä¸­ï¼Œä½¿å…¶æœ¬è´¨ä¸Šæˆä¸ºäº† HTTP åè®®ç±»å‹çš„åŠ å¯†æµé‡ã€‚è¿™ç§ç±»å‹çš„è¯·æ±‚æ— æ³•ä½¿ç”¨ protocol==dns è¿›è¡Œæ•è·ï¼Œå¦‚ wireshark çš„æˆªå›¾æ‰€ç¤ºï¼Œçœ‹ä¸åˆ°æŸ¥è¯¢ <code>api.dida365.com</code> çš„å“åº”çºªå½•ã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715192020922.png width=1460 height=193 srcset="/p/dive-into-clash-dns/image-20230715192020922_hu89b0e13e4d05c57b691796638e3491eb_142888_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192020922_hu89b0e13e4d05c57b691796638e3491eb_142888_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=756 data-flex-basis=1815px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>TCP<span class=o>]</span> 127.0.0.1:64007<span class=o>(</span>msedge.exe<span class=o>)</span> --&gt; api.dida365.com:443 match GeoSite<span class=o>(</span>cn<span class=o>)</span> using DIRECT
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥å¾—å‡ºå¦‚ä¸‹é˜¶æ®µæ€§ç»“è®ºï¼š</p><ol><li><p><strong>è®¿é—®åŸŸåæ—¶é‡åˆ°ç›´è¿åŸŸåè§„åˆ™ï¼Œä»æœ¬åœ°å‘èµ· DNS è¯·æ±‚</strong></p><p><code>api.dida365.com</code> æ˜¯ä¸€ä¸ªåœ¨ <code>geosite:cn</code> æ•°æ®åº“ä¸­çš„è§„åˆ™ï¼Œå…¶å¯¹åº”äº†æˆ‘ä»¬çš„å‡ºç«™ç­–ç•¥ <strong>DIRECT</strong>ï¼ˆè¯¦è§ä¸Šæ–‡çš„ rulesï¼‰ï¼Œä¹Ÿå³ï¼Œä¸‹é¢è¿™ä¸¤ç§æƒ…å†µæ˜¯ç­‰ä»·çš„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,CN,DIRECT</span><span class=w> </span><span class=c># A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida365.com,DIRECT</span><span class=w> </span><span class=c># B</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p><strong><em>default-nameserver</em> ä»…ç”¨æ¥è§£æ <em>nameserver</em> å­—æ®µä¸­é…ç½®çš„åŸŸå</strong></p><p>è¿™ä¹Ÿè¯´æ˜äº† <em>default-nameserver</em> ä¸ºä»€ä¹ˆåªèƒ½å†™ IP è€Œä¸èƒ½å†™åŸŸåï¼Œè¿™ä¼šé‡åˆ°å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ã€‚ä½†å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<em>default-nameserver</em> æ”¯æŒ HTTPS å†™æ³•ã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœ <em>nameserver</em> ä¸­æ²¡æœ‰é…ç½®åŸŸåå½¢å¼çš„ <em>DOH/DOT/DOQ</em>ï¼Œåˆ™ <em>default-nameserver</em> å¯¹åº”çš„ä¸šåŠ¡ä»£ç ä¸ä¼šè¢«è§¦å‘ã€‚ï¼ˆå…·ä½“æƒ…å†µçœ‹ä¸‹æ–‡çš„æµ‹è¯•ï¼‰</p></li><li><p><strong>é€šè¿‡ <em>nameserver</em> è§£ææˆ‘ä»¬è¦è®¿é—®çš„åŸŸå</strong></p></li></ol><h4 id=è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-dns-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DNS IP</h4><blockquote><p>ä»è¿™é‡Œå¼€å§‹æˆ‘ä»¬å°±ä¸è´´è§„åˆ™åŒ¹é…çš„æ—¥å¿—äº†ï¼Œç»“æœéƒ½å’Œå¯¹ç…§ç»„ä¸€æ ·ã€‚æˆ‘ä»¬åœ¨ä»…ä¿®æ”¹ DNS é…ç½®çš„æƒ…å†µä¸‹ï¼ŒåŒä¸€ target çš„å‡ºç«™ç­–ç•¥ä¸å—å½±å“ã€‚</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¡Œè¿›æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>ä½¿ç”¨ <em>nameserver</em> è§£ææˆ‘ä»¬è¦è®¿é—®çš„åŸŸå</p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å‘ï¼ˆäººä¸ºé…ç½®çš„ï¼‰223.5.5.5 å‘èµ·äº†æ˜æ–‡ DNS è¯·æ±‚å¹¶æ”¶åˆ°äº†æŸ¥è¯¢å“åº”ã€‚å…¶ä¸­ï¼Œé™¤äº†æˆ‘ä»¬è®¿é—®çš„ <code>api.dida365.com</code> ï¼Œè¿˜èƒ½çœ‹åˆ°å…¶ä»–é©»å°ç¨‹åºå‘èµ·çš„ DNS è¯·æ±‚ã€‚</p><p>æ˜¾ç„¶ï¼Œè¿™ä¸å¯¹ç…§ç»„çš„ç»“æœä¸ä¸€è‡´ã€‚</p><p>å…·ä½“æ¥è¯´ ï¼Œæˆ‘ä»¬åœ¨å¯¹ç…§ç»„ï¼ˆé»˜è®¤é…ç½®ï¼‰ä¸‹ä½¿ç”¨ DOH <a class=link href=https://doh.pub/dns-query target=_blank rel=noopener>https://doh.pub/dns-query</a> å‘é€åŸŸåè§£æè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ä¸€ä¸ªå°è£…åœ¨ HTTPS æ•°æ®åŒ…ä¸­çš„åŠ å¯†ç”³è¯·ï¼Œæˆ‘ä»¬æ— æ³•åœ¨è¿‡æ»¤æ¡ä»¶ä¸º <code>dns</code> çš„ç­›é€‰ä¸­æ•è·åˆ°è¿™æ¡è§£æè¯·æ±‚ã€‚è€Œæœ¬ç»„å®éªŒè®¾ç½®ä¸­ä½¿ç”¨äº†æœªç»åŠ å¯†çš„ç”³è¯·ï¼Œä¹Ÿå³ <strong>udp://223.5.5.5:53</strong>ï¼ˆè¡Œè¿›æºç è‡ªåŠ¨è¡¥å…¨ä¸º URLï¼‰ï¼Œè¿™æ˜¯ä¸€æ¡å‘½ä¸­ <code>dns</code> è¿‡æ»¤è§„åˆ™çš„è¯·æ±‚ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ•è·åˆ°å®ƒï¼Œè¿˜èƒ½çœ‹è§å®ƒçš„ Message/Informationï¼Œå³ï¼Œè¦è®¿é—®/è¦è§£æçš„ç«™ç‚¹ã€‚</p></li><li><p>ç”±äº<strong>æˆ‘ä»¬æœªé…ç½®åŸŸåå½¢å¼çš„ DOH</strong>ï¼Œæ‰€ä»¥ <em>default-nameserver</em> ç›¸å…³è¡Œè¿›ä»£ç æœªè¢«è§¦å‘ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715192539131.png width=1460 height=136 srcset="/p/dive-into-clash-dns/image-20230715192539131_hu46dbbc8a5173a5abc7d300ae0aea994b_116519_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192539131_hu46dbbc8a5173a5abc7d300ae0aea994b_116519_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=1073 data-flex-basis=2576px></p><h4 id=è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-doh-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DOH: IP</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://223.5.5.5/dns-query</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¡Œè¿›æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>ä½¿ç”¨ <em>nameserver</em> è§£ææˆ‘ä»¬è¦è®¿é—®çš„åŸŸå</p><p>æˆ‘ä»¬å‘ IP å½¢å¼çš„ DOH å‘èµ·äº†å¯¹ <code>api.dida365.com</code> åŸŸåè§£æè¯·æ±‚ï¼Œè¯·æ±‚è¢«åŠ å¯†åˆ° HTTPS æ•°æ®åŒ…ä¸­ï¼Œé€šè¿‡ dns ç­›é€‰æ— æ³•æ•è·ã€‚</p></li><li><p>ç”±äº<strong>æˆ‘ä»¬æœªé…ç½®åŸŸåå½¢å¼çš„ DOH</strong>ï¼Œæ‰€ä»¥ <em>default-nameserver</em> ç›¸å…³è¡Œè¿›ä»£ç æœªè¢«è§¦å‘ã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715192605396.png width=1460 height=112 srcset="/p/dive-into-clash-dns/image-20230715192605396_huc4d0330bb6469d0aba90b1a0f2013393_18988_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192605396_huc4d0330bb6469d0aba90b1a0f2013393_18988_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=1303 data-flex-basis=3128px></p></li><li><p>å½“æˆ‘ä»¬ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å¯ä»¥é™†ç»­æ”¶åˆ°æ¥è‡ªç³»ç»ŸDNSï¼ˆç½‘å…³ï¼‰è¿”å›çš„ DNS æŸ¥è¯¢å“åº”ã€‚æŒ‰ç†è¯´ï¼Œæˆ‘ä»¬çš„è¯·æ±‚ä¸æ˜¯è¢«åŠ å¯†äº†å—ï¼Ÿè¦å“åº”ä¹Ÿåº”è¯¥æ˜¯ HTTPS ç±»å‹çš„åè®®ï¼Œå†ä¸æµä¹Ÿåº”è¯¥æ˜¯é˜¿é‡ŒæœåŠ¡å™¨è¿”å›çš„å“åº”å•Šï¼Ÿï¼ˆä¹Ÿå³ <code>dns && ip.src==223.5.5.5</code>ï¼‰æ€ä¹ˆä¼šæœ‰æ¥è‡ªæœ¬åœ°è¿è¥å•†å‘æ¥çš„ DNS æŸ¥è¯¢å“åº”å‘¢ï¼Ÿ</p><p>è¿™æ¶‰åŠåˆ° Windows æ“ä½œç³»ç»Ÿçº§çš„ DNS æŸ¥è¯¢ç»„ç­–ç•¥ï¼Œæˆ‘ä»¬åæ–‡ç»†è¯´ã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715192620101.png width=1460 height=153 srcset="/p/dive-into-clash-dns/image-20230715192620101_hu0f3f6089e9ff7f8c928d1d3e58376b90_177260_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192620101_hu0f3f6089e9ff7f8c928d1d3e58376b90_177260_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=954 data-flex-basis=2290px></p></li></ol><h4 id=è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-doh-domain>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DOH: domain</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ˜¯ä¸æ˜¯ç†Ÿæ‚‰çš„æ„Ÿè§‰åˆå›æ¥äº†~ğŸ§</p><p>è¡Œè¿›æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>ä½¿ç”¨ <em>nameserver</em> è§£ææˆ‘ä»¬è¦è®¿é—®çš„åŸŸå</p><p>ä¸å¯¹ç…§ç»„çš„æƒ…å†µä¸€ç›´ï¼Œè¿™æ˜¯ä¸ªåŠ å¯†è¯·æ±‚ï¼Œåæ–‡ä¸å†èµ˜è¿°ã€‚</p></li><li><p><strong>æˆ‘ä»¬é…ç½®äº†åŸŸåå½¢å¼çš„ DOH</strong>ï¼Œ<em>default-nameserver</em> ç›¸å…³ä»£ç å¼€å§‹æ‰§è¡Œã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715192644224.png width=1460 height=195 srcset="/p/dive-into-clash-dns/image-20230715192644224_huc93d893886078e68ba7f92e3db185b57_261789_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192644224_huc93d893886078e68ba7f92e3db185b57_261789_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=748 data-flex-basis=1796px></p><h3 id=å¼•å…¥-namesever-policy>å¼•å…¥ namesever-policy</h3><blockquote><p>ğŸ’¡ä¼˜å…ˆçº§é«˜äº <em>nameserver</em></p></blockquote><h4 id=è§„åˆ™æ¨¡å¼---åŒæ—¶è®¾ç½®-nameserver-policy-å’Œ-nameserver>è§„åˆ™æ¨¡å¼ - åŒæ—¶è®¾ç½® <em>nameserver-policy</em> å’Œ <em>nameserver</em></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.0.0.1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>nameserver-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p>å½“æˆ‘ä»¬è®¿é—® <code>api.dida365.com</code> æ—¶ä¼˜å…ˆä½¿ç”¨ 1.0.0.1 è¿›è¡ŒåŸŸåè§£æã€‚é™¤æ­¤ä¹‹å¤–æ‰€æœ‰çš„ DNS è¯·æ±‚éƒ½èµ° 223.5.5.5ï¼Œæ¯”å¦‚éšåå“åº”çš„<code>cdn.dida365.com</code>ã€‚</p></li><li><p>ç”±äº <em>nameserver</em> å’Œ <em>nameserver-policy</em> éƒ½ä¸å­˜åœ¨åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ç›¸å…³ä»£ç ä¸å¯åŠ¨</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715192921676.png width=1460 height=310 srcset="/p/dive-into-clash-dns/image-20230715192921676_hua0bab46442daaaf97a1159327dd136a8_462319_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192921676_hua0bab46442daaaf97a1159327dd136a8_462319_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=470 data-flex-basis=1130px></p><h4 id=è§„åˆ™æ¨¡å¼---æ··ç”¨-doh>è§„åˆ™æ¨¡å¼ - æ··ç”¨ DOH</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>119.29.29.29</span><span class=w> </span><span class=c># è…¾è®¯ IPv4 DNS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸€è·¯çœ‹åˆ°è¿™ä½ åº”è¯¥èƒ½è‡ªå·±æ€»ç»“è¡Œè¿›æ­¥éª¤äº†~ğŸ§</p><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>nameserver-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p><em>nameserver-policy</em> ä¼˜å…ˆç”Ÿæ•ˆï¼Œé‡Œé¢æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> å¯åŠ¨ ï¼›è§£æ <code>api.dida365.com</code> çš„ DNS è¯·æ±‚è¢«åŠ å¯†æˆ HTTPSï¼Œåœ¨ dns ç­›é€‰ä¸­ä¸æ˜¾ç¤ºã€‚</p><p>é™¤æ­¤ä¹‹å¤–æ‰€æœ‰çš„ DNS è¯·æ±‚éƒ½èµ° 119.29.29.29ï¼Œæ¯”å¦‚éšåå“åº”çš„<code>cdn.dida365.com</code>ã€‚<em>nameserver</em> ä¸­æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715192944128.png width=1460 height=201 srcset="/p/dive-into-clash-dns/image-20230715192944128_hue5f237253565dcb1eae698991c88faed_259286_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715192944128_hue5f237253565dcb1eae698991c88faed_259286_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=726 data-flex-basis=1743px></p><h4 id=è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-policy-ä¸º-doh-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver-policy</em> ä¸º DOH: IP</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://223.5.5.5/dns-query</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>nameserver-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p><em>nameserver-policy</em> ç”Ÿæ•ˆï¼Œé‡Œé¢æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ ï¼›è§£æ <code>api.dida365.com</code> çš„ DNS è¯·æ±‚è¢«åŠ å¯†æˆ HTTPSï¼Œåœ¨ dns ç­›é€‰ä¸­ä¸æ˜¾ç¤ºã€‚</p><p>å…¶ä»–çš„ DNS è¯·æ±‚éƒ½èµ° <em>nameserver</em> ,ä¹Ÿå³é»˜è®¤å€¼ <code>https://doh.pub/dns-query</code> ï¼Œè¿™æ˜¯ä¸€æ¡åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> å¯åŠ¨ã€‚</p><p>æ˜¾ç„¶ï¼Œèµ° DOH çš„ DNS è¯·æ±‚è¢«åŠ å¯†ï¼Œåœ¨ wireshark ç»“æœä¸­çœ‹ä¸åˆ° target å“åº”</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715193000271.png width=1460 height=179 srcset="/p/dive-into-clash-dns/image-20230715193000271_hua540d46dbc336b4d471f80e0f323031e_217105_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193000271_hua540d46dbc336b4d471f80e0f323031e_217105_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=815 data-flex-basis=1957px></p><h4 id=è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-policy-ä¸º-doh-domain>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver-policy</em> ä¸º DOH: domain</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>nameserver-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p><em>nameserver-policy</em> ç”Ÿæ•ˆï¼Œé‡Œé¢æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> å¯åŠ¨ ï¼›è§£æ <code>api.dida365.com</code> çš„ DNS è¯·æ±‚è¢«åŠ å¯†æˆ HTTPSï¼Œåœ¨ dns ç­›é€‰ä¸­ä¸æ˜¾ç¤ºã€‚</p><p>å…¶ä»–çš„ DNS è¯·æ±‚éƒ½èµ° <em>nameserver</em> ,ç»“æœåŒä¸Šä¸€åˆ™å®éªŒä¸€è‡´ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715193019120.png width=1460 height=409 srcset="/p/dive-into-clash-dns/image-20230715193019120_huc1e892ccf6da88c04cbcd53b7caa8e67_512936_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193019120_huc1e892ccf6da88c04cbcd53b7caa8e67_512936_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=356 data-flex-basis=856px></p><h3 id=å¼•å…¥-dns-åˆ†æµ>å¼•å…¥ DNS åˆ†æµ</h3><blockquote><p>ğŸ’¡ä½ å¦‚æœæ˜¯ä¸€ä¸ª Clash éª¨ç°çº§ç©å®¶æˆ–æ˜¯é¡¹ç›®çš„æ ¸å¿ƒè´¡çŒ®è€…ï¼Œä¹Ÿè®¸æœ‰è¿™æ ·çš„æ„Ÿæ‚Ÿï¼šDNS æ˜¯ clash ç±»é¡¹ç›®è®¾è®¡æœ€ä¸ºç²¾å¦™ä¹Ÿæ˜¯æœ€å¤æ‚çš„æœºåˆ¶ï¼Œç”šè‡³æ²¡æœ‰ä¹‹ä¸€ã€‚</p></blockquote><h4 id=è§„åˆ™æ¨¡å¼---åŸŸåè§„åˆ™çš„è§£æ>è§„åˆ™æ¨¡å¼ - åŸŸåè§„åˆ™çš„è§£æ</h4><p>æ·»åŠ å‡ºç«™è§„åˆ™ï¼Œå°† <code>api.dida365.com</code> è®¾ä¸º <em>#PROXY</em> å‡ºç«™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c># åœ¨å¯¹ç…§è§„åˆ™ä¹‹å‰è¯¥æ¡æ·»åŠ è§„åˆ™</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>DOMAIN,api.dida365.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c># -- skip  --</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ 8.8.8.8 æ ‡è®° <code>api.dida365.com</code> ï¼Œä½¿ç”¨ 223.5.5.5 æ ‡è®°å…¶ä»–è¯·æ±‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>https://dns.alidns.com/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>https://dns.google/dns-query</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8.8.8.8</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨å¼€å§‹è¯¥ç»„å®éªŒå‰ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸Šæ–‡å®éªŒç»“æœæå‡ºå¦‚ä¸‹å‡è®¾ï¼š</p><p><strong>&lt;A></strong> âœ… å¦‚æœæµè§ˆå™¨å‘ <code>api.dida365.com</code> å‘å‡ºè¯·æ±‚ï¼Œå¿…ç„¶è§¦å‘ <em>nameserver-policy</em> çš„åŸŸåè§£æä»»åŠ¡ï¼›<em>nameserver-policy</em> å†…æœ‰åŸŸåå½¢å¼çš„DOHï¼Œå¿…ç„¶ä¼šä½¿ç”¨ <em>default-nameserver</em>ï¼ˆå¹¶å‘ï¼‰è§£æ <code>dns.google</code> ï¼Œæœ€åä½¿ç”¨è§£æåˆ°çš„ DOH IP å’Œ 8.8.8.8 ï¼ˆå¹¶å‘ï¼‰è§£æ <code>api.dida365.com</code>ã€‚</p><p><strong>&lt;B></strong> âœ… ï¼ˆå‡è®¾æ²¡æœ‰å‘ç”Ÿ IP è§„åˆ™åŒ¹é…ï¼‰å…¶ä»–çš„åŸŸåç›´è¿è¯·æ±‚ä½¿ç”¨ <em>nameserver</em> è¿›è¡Œè§£æï¼Œæ˜¾ç„¶ <em>nameserver</em> ç»„å†…ä¹Ÿæœ‰åŸŸåå½¢å¼çš„ DOHï¼Œå¿…ç„¶ä½¿ç”¨ <em>default-nameserver</em> ï¼ˆå¹¶å‘ï¼‰è§£æ <code>dns.alidns.com</code> ï¼Œä½¿ç”¨è§£æåˆ°çš„ DOH IP å’Œ 223.5.5.5 å¹¶å‘æŸ¥è¯¢æˆ‘ä»¬è¦è®¿é—®çš„åŸŸåã€‚</p><p>æŠ“åŒ…ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆéšå»è‹¥å¹²æ¡æ‚è´¨æ•°æ®ï¼‰ï¼š</p><p><img src=/p/dive-into-clash-dns/image-20230715193212997.png width=1460 height=387 srcset="/p/dive-into-clash-dns/image-20230715193212997_hu5bf5753870fe65ca3599d58c7db4ff4e_489021_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193212997_hu5bf5753870fe65ca3599d58c7db4ff4e_489021_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=377 data-flex-basis=905px></p><blockquote><p>ğŸ´â€â˜ ï¸ æˆ‘ä»¬å…ˆåœ¨è¿™ä¸ªç»„å®éªŒä¸­æŠ›å‡º &lt;DNSæ³„æ¼> çš„æ¦‚å¿µï¼Œå…·ä½“å†…å®¹åæ–‡ç»†è¯´ã€‚</p></blockquote><p>å¯ä»¥å¾—å‡ºå¦‚ä¸‹è§‚å¯Ÿçºªå½•ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬èƒ½è§‚å¯Ÿåˆ° <em>default-nameserver</em> å¼€å§‹è§£æ <code>dns.alidns.com</code> åŸŸåï¼Œè¯´æ˜ <em>nameserver</em> è¢«è§¦å‘ï¼Œè¯´æ˜æœ‰å…¶ä»–<strong>åŸŸåç›´è¿è¯·æ±‚å‘½ä¸­äº† DIRECT åŸŸåè§„åˆ™</strong>ï¼ˆå‡è®¾æ²¡æœ‰å‘ç”Ÿ IP è§„åˆ™åŒ¹é…ï¼‰ã€‚</p><p>è€Œå½“æˆ‘ä»¬ä¸é—´æ–­åœ°è¯·æ±‚ <code>api.dida365.com</code> æ—¶ï¼Œæˆ‘ä»¬ä¸ºå…¶é…ç½®çš„ <em>nameserver-policy</em> å¹¶æœªç”Ÿæ•ˆï¼Œæˆ‘ä»¬åœ¨ <strong>&lt;A></strong> ä¸­å‡è±¡çš„é€»è¾‘é“¾æ²¡æœ‰å‘ç”Ÿï¼Œä¹Ÿå³ï¼Œclash å¹¶æœªå‘ <em>default-nameserver</em> å‘èµ·é’ˆå¯¹ <code>dns.google</code> çš„åŸŸåè§£æè¯·æ±‚ï¼Œæˆ–è€…è¯´ï¼Œæœ¬åœ°æ²¡æœ‰å‘èµ·å¯¹ <code>api.dida365.com</code> çš„ç›´è¿è®¿é—®è¯·æ±‚ã€‚</p><p>æ˜¾ç„¶ï¼Œ<strong>æˆ‘ä»¬å°† <code>api.dida365.com</code> è®¾ç½®ä¸º <em>PROXY</em> å‡ºç«™åï¼Œè®¿é—®ç›®æ ‡ç«™ç‚¹çš„å·¥ä½œäº¤ç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆï¼Œè‡ªç„¶åœ°ï¼ŒåŸŸåè§£æçš„å·¥ä½œä¹Ÿç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆ</strong>ã€‚æœ¬åœ°åšçš„ï¼Œåªæ˜¯å°†è®¿é—® <code>api.dida365.com</code> çš„ä»£ç†è¯·æ±‚å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œä¹Ÿå³ï¼Œå‘½ä¸­ <em>PROXY</em> åŸŸåè§„åˆ™åï¼Œclash ä¼šç›´æ¥è·³è¿‡ DNS æ­¥éª¤å‘è¿œç¨‹æœåŠ¡å™¨å‘ˆé€æ•°æ®åŒ…ã€‚</p><h4 id=è§„åˆ™æ¨¡å¼---åŸŸåè§„åˆ™çš„è§£æ---éªŒè¯>è§„åˆ™æ¨¡å¼ - åŸŸåè§„åˆ™çš„è§£æ - éªŒè¯</h4><ul><li><strong>éªŒè¯ &lt;1></strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8.8.8.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida36768990.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># -- skip --</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida36768990.com</code>ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>nameserver-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p><em>nameserver-policy</em> ç”Ÿæ•ˆï¼Œé‡Œé¢æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ï¼Œç›´æ¥ä½¿ç”¨ 8.8.8.8 è§£æ <code>api.dida36768990.com</code>ã€‚</p><p>æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåï¼ŒDNS å“åº”å‡ºç° no such name é”™è¯¯ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715193406460.png width=1460 height=236 srcset="/p/dive-into-clash-dns/image-20230715193406460_hua2a577e573b6e2308569eba0d075462a_349695_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193406460_hua2a577e573b6e2308569eba0d075462a_349695_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=618 data-flex-basis=1484px></p><ul><li><strong>éªŒè¯ &lt;2></strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8.8.8.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c># åœ¨å¯¹ç…§ç»„ä¹‹å‰æ·»åŠ è§„åˆ™</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>DOMAIN,api.dida36768990.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>DOMAIN,api.dida365.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c># -- skip --</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><p><strong>æƒ…å†µ1</strong>ï¼šæµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p><p>æœªå‘½ä¸­ <em>nameserver-policy</em>ï¼Œåˆ‡æ¢è‡³ <em>nameserver</em> ï¼Œç»„å†…æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ï¼Œç›´æ¥å‘ 223.5.5.5 å‘èµ·åŸŸåè§£æè¯·æ±‚ï¼ˆç»¿è‰²è®°å½•ï¼‰ã€‚</p><p>å…¶ä»–å‘½ä¸­<strong>åŸŸåç›´è¿è§„åˆ™</strong>çš„è¯·æ±‚ä¹Ÿæ˜¯ç”¨ nameserver è¿›è¡ŒåŸŸåè§£æï¼ˆæ©™è‰²è®°å½•ï¼‰ã€‚</p><p>ç›¸å…³ DNS è¯·æ±‚å‡æœªè¢«åŠ å¯†ï¼Œå¯ä»¥çœ‹åˆ°æŠ“åŒ…è®°å½•ã€‚</p></li><li><p><strong>æƒ…å†µ2</strong>ï¼šæµè§ˆå™¨è®¿é—® <code>api.dida36768990.com</code>ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p><p>å‘½ä¸­ <em>nameserver-policy</em>ï¼Œç»„å†…æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ï¼Œç›´æ¥å‘ 8.8.8.8 å‘èµ·åŸŸåè§£æè¯·æ±‚ã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåï¼ŒDNS å“åº”å‡ºç° no such name é”™è¯¯ï¼ˆé»„è‰²è®°å½•ï¼‰ã€‚</p></li></ul><p><img src=/p/dive-into-clash-dns/image-20230715193441482.png width=1460 height=317 srcset="/p/dive-into-clash-dns/image-20230715193441482_hu08f23afb31c4c6256fbfcb60c2b38ac3_437478_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193441482_hu08f23afb31c4c6256fbfcb60c2b38ac3_437478_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=460 data-flex-basis=1105px></p><h4 id=è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ</h4><p>é¦–å…ˆä¿®æ”¹å‡ºç«™è§„åˆ™ï¼Œåˆ†åˆ«ä½¿ç”¨ 223.5.5.5 å’Œ 180.76.76.76 æ ‡è®° <code>api.dida365.com</code> å’Œ <code>api.dida36768990.com</code> å…¶ä½™ç›´è¿è¯·æ±‚ä½¿ç”¨ 119.29.29.29ã€‚è¿™é‡Œä¸ºäº† trace çºªå½•å¹²å‡€æ•´æ´ä¾¿äºåŸç†åˆ†æï¼Œå°±ä¸ä½¿ç”¨åŸŸå DOH äº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>119.29.29.29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>180.76.76.76</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida36768990.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida365.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida365.com</code> ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p><strong>é‡åˆ°</strong> <strong>GEOIP ä»£ç†è§„åˆ™ï¼Œå‘èµ·æœ¬åœ° DNS æŸ¥è¯¢</strong></p><p>å¾ˆå¤šå°ä¼™ä»¬å›°æƒ‘çš„ç‚¹å°±åœ¨è¿™äº†ï¼æ ¹æ®æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ç»“è®ºï¼Œè®¿é—®åŸŸåæ—¶é‡åˆ° IP è§„åˆ™ä¼šè¿›è¡ŒDNS è§£æï¼Œé‡åˆ°ä»£ç†è§„åˆ™ä¼šå°†è¯·æ±‚å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ã€‚é‚£è¿™ç§ç‰¹æ®Šæƒ…å†µåˆ°åº•æ˜¯å…ˆè¿›è¡Œ DNS è§£æè¿˜æ˜¯ç›´æ¥å°†æ•°æ®åŒ…å‘ˆé€åˆ°è¿œç¨‹æœåŠ¡å™¨è·³è¿‡DNSè§£æå‘¢ï¼Ÿ</p><p><strong>è®¿é—®åŸŸåæ—¶é‡åˆ° IP è§„åˆ™ï¼Œå…ˆè¿›è¡Œæœ¬åœ° DNS è§£æï¼Œå°†è¦è¯·æ±‚çš„åŸŸåè§£ææˆ IPï¼Œå†ä¸ IP è§„åˆ™é›†ä¸­çš„ IP è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœå‘½ä¸­ï¼Œå‡ºç«™è§„åˆ™ç”Ÿæ•ˆï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€ä¸ªè§„åˆ™é›†ã€‚</strong></p><p><strong>è®¿é—®åŸŸåæ—¶é‡åˆ°åŸŸåè§„åˆ™ï¼Œå¦‚æœæ˜¯ç›´è¿å‡ºç«™ï¼Œåˆ™ç”±æœ¬åœ°å‘èµ· DNS æŸ¥è¯¢ï¼›å¦‚æœæ˜¯ä»£ç†å‡ºç«™ï¼Œåˆ™è·³è¿‡ DNS æŸ¥è¯¢å¹¶å°†ä»£ç†è¯·æ±‚å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ã€‚</strong></p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>namesever-policy</em> è§£æåŸŸå <code>api.dida365.com</code></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ¬åœ°å‘ 233.5.5.5 å‘èµ·äº†é’ˆå¯¹ <code>api.dida365.com</code> çš„ DNS è¯·æ±‚ï¼Œè¿™éªŒè¯äº†æˆ‘ä»¬å‰æ–‡è¯´çš„å†…å®¹ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715193528765.png width=1460 height=169 srcset="/p/dive-into-clash-dns/image-20230715193528765_hudfd0dc39c88ff2f81e7f1d77ea97ec90_216141_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193528765_hudfd0dc39c88ff2f81e7f1d77ea97ec90_216141_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=863 data-flex-basis=2073px></p><h4 id=è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ---åŸç†å‰–æ>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ - åŸç†å‰–æğŸ´â€â˜ ï¸</h4><p>å…ˆé˜…è¯»ä¸Šä¸€èŠ‚ï¼Œå¦åˆ™ä½ å¯èƒ½çœ‹ä¸æ‡‚è¿™é‡Œå†™çš„ä¸œè¥¿ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>119.29.29.29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>180.76.76.76</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida36768990.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida365.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>æµè§ˆå™¨è®¿é—® <code>api.dida36768990.com</code>ï¼Œè¯·æ±‚é€šè¿‡ç³»ç»Ÿä»£ç†è¿›å…¥ clash</p></li><li><p><strong>é‡åˆ°</strong> <strong>GEOIP ä»£ç†è§„åˆ™ï¼Œå‘èµ·æœ¬åœ° DNS æŸ¥è¯¢</strong></p></li><li><p>å‘½ä¸­è§„åˆ™ï¼Œä½¿ç”¨ <em>namesever-policy</em> è§£æåŸŸå <code>api.dida36768990.com</code></p><p>ç»„å†…æ²¡æœ‰åŸŸåå½¢å¼çš„ DOHï¼Œ<em>default-nameserver</em> ä¸å¯åŠ¨ï¼Œç›´æ¥ä½¿ç”¨ 180.76.76.76 è¿›è¡ŒåŸŸåè§£æã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦è®¿é—®çš„æ˜¯ä¸€ä¸ªä¸å­˜åœ¨çš„åŸŸåï¼Œè‡ªç„¶æ— æ³•å¾—åˆ°å¯¹åº”çš„ IPï¼ˆå¦‚ä¸‹å›¾ç»¿æ ‡çš„ no such nameä¿¡æ¯ï¼‰ï¼Œä¹Ÿå³ï¼Œè¿™æ¡é€šè·¯æŠ¥é”™äº†ã€‚</p></li></ol><p><img src=/p/dive-into-clash-dns/image-20230715193548913.png width=1460 height=417 srcset="/p/dive-into-clash-dns/image-20230715193548913_hudb0998eb8594acbbb17fa82290a0d41f_620412_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193548913_hudb0998eb8594acbbb17fa82290a0d41f_620412_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=350 data-flex-basis=840px></p><p>é‚£ä¹ˆ clash ä¼šå¦‚ä½•å¤„ç†è¿™ä¸ªè¯·æ±‚å‘¢ï¼Ÿ</p><p>clash ParseRule çš„è¡Œè¿›ç­–ç•¥æ˜¯ <code>for-loop with switch-case</code>ï¼ŒèŠ‚å–ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// èŠ‚å–
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=nx>idx</span><span class=p>,</span> <span class=nx>line</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>rulesConfig</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>parsed</span><span class=p>,</span> <span class=nx>parseErr</span> <span class=o>:=</span> <span class=nf>ParseRule</span><span class=p>(</span><span class=nx>ruleName</span><span class=p>,</span> <span class=nx>payload</span><span class=p>,</span> <span class=nx>target</span><span class=p>,</span> <span class=nx>params</span><span class=p>,</span> <span class=nx>subRules</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>parseErr</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;%s[%d] [%s] error: %s&#34;</span><span class=p>,</span> <span class=nx>format</span><span class=p>,</span> <span class=nx>idx</span><span class=p>,</span> <span class=nx>line</span><span class=p>,</span> <span class=nx>parseErr</span><span class=p>.</span><span class=nf>Error</span><span class=p>())</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// èŠ‚å–
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseRule</span><span class=p>(</span><span class=nx>ruleName</span><span class=p>,</span> <span class=nx>payload</span><span class=p>,</span> <span class=nx>target</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>params</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span> <span class=nx>subRules</span> <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>][]</span><span class=nx>C</span><span class=p>.</span><span class=nx>Rule</span><span class=p>)</span> <span class=p>(</span><span class=nx>parsed</span> <span class=nx>C</span><span class=p>.</span><span class=nx>Rule</span><span class=p>,</span> <span class=nx>parseErr</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span> <span class=nx>ruleName</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;DOMAIN&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>parsed</span> <span class=p>=</span> <span class=nx>RC</span><span class=p>.</span><span class=nf>NewDomain</span><span class=p>(</span><span class=nx>payload</span><span class=p>,</span> <span class=nx>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;GEOSITE&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>parsed</span><span class=p>,</span> <span class=nx>parseErr</span> <span class=p>=</span> <span class=nx>RC</span><span class=p>.</span><span class=nf>NewGEOSITE</span><span class=p>(</span><span class=nx>payload</span><span class=p>,</span> <span class=nx>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;GEOIP&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>noResolve</span> <span class=o>:=</span> <span class=nx>RC</span><span class=p>.</span><span class=nf>HasNoResolve</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>parsed</span><span class=p>,</span> <span class=nx>parseErr</span> <span class=p>=</span> <span class=nx>RC</span><span class=p>.</span><span class=nf>NewGEOIP</span><span class=p>(</span><span class=nx>payload</span><span class=p>,</span> <span class=nx>target</span><span class=p>,</span> <span class=nx>noResolve</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s>&#34;MATCH&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>parsed</span> <span class=p>=</span> <span class=nx>RC</span><span class=p>.</span><span class=nf>NewMatch</span><span class=p>(</span><span class=nx>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>parseErr</span> <span class=p>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>parseErr</span> <span class=p>=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;unsupported rule type %s&#34;</span><span class=p>,</span> <span class=nx>tp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>parseErr</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>parseErr</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>clash ä»ä¸Šè‡³ä¸‹é€è¡Œè¯»å– rulesï¼Œæ¯ä¸ªè§„åˆ™é›†éƒ½ä¼šè¿›å…¥åˆ°ä¸€ä¸ª case å­ä¸šåŠ¡é“¾è·¯ï¼Œæˆ‘ä»¬è¿™é‡Œè¿›å…¥çš„æ˜¯ <strong>GEOIP</strong> çš„ caseï¼Œå®ƒé¦–å…ˆä¼šè¯†åˆ«æ˜¯å¦å­˜åœ¨ <em><strong>no-resolve</strong></em> æ ‡è¯†ï¼Œå†ä»¥æ­¤å†³å®š NewGEOIP çš„å…·ä½“è¡Œä¸ºã€‚GEOIP çš„è§„åˆ™åŒ¹é…æµç¨‹æ­¤å¤„ä¸è¿‡å¤šèµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œç¿»é˜…æºç ã€‚</p><p>é‚£ä¹ˆï¼Œæ ¹æ®æˆ‘ä»¬å…ˆå‰çš„è®¨è®ºï¼Œè¿™é‡Œçš„ parseErr å¿…ç„¶æ˜¯â€œæœ‰å†…å®¹çš„â€ï¼Œä¹Ÿå³<strong>è¿™ä¸ªé”™è¯¯ä¼ é€’åˆ°ä¸Šå±‚çš„ for å¾ªç¯åä¼šä¸­æ–­å¾ªç¯ï¼Œä½¿å¾—ç¨‹åºä¸ä¼šè¡Œè¿›åˆ°ä¸‹ä¸€æ¡ rule</strong>ï¼Œä¹Ÿå³ <code>DOMAIN,api.dida36768990.com,DIRECT</code> ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå½“æˆ‘ä»¬è¯•å›¾å°† <code>api.dida36768990.com</code>æ‰€å¯¹åº”çš„ IP ä¸è§„åˆ™é›† <code>GEOIP,CN,PROXY</code> è¿›è¡Œé…å¯¹æ—¶é‡åˆ°äº†é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯é¦–å…ˆä¸­æ–­åŒ¹é…è¡Œè¿›ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ï¼Œéšåå‘ä¸Šä¸€ç›´ä¼ å¯¼è‡³ main æ¥å£ï¼Œæ²¿é€”è§¦å‘æ‰€æœ‰çš„ warning + çº§åˆ«çš„æ—¥å¿—è­¦å‘Šã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715193605977.png width=1460 height=206 srcset="/p/dive-into-clash-dns/image-20230715193605977_huf2ed1aa4b0b2d2c5b2dace11891aaf99_131361_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193605977_huf2ed1aa4b0b2d2c5b2dace11891aaf99_131361_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=708 data-flex-basis=1700px></p><h4 id=è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ---éªŒè¯>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ - éªŒè¯</h4><ul><li><p>GEOIP <em>no-resolve</em> only, REQUEST GET <code>api.dida365.com</code> + <code>api.dida36768990.com</code></p><p>è·³è¿‡ GEOIP çš„æœ¬åœ°åŸŸåè§£æï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€ä¸ªè§„åˆ™é›†çš„åŒ¹é…</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>119.29.29.29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>180.76.76.76</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,DIRECT,no-resolve</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/dive-into-clash-dns/image-20230715193635868.png width=1460 height=108 srcset="/p/dive-into-clash-dns/image-20230715193635868_hu29dbd62f1b5cb17ba426b12dee120033_18562_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193635868_hu29dbd62f1b5cb17ba426b12dee120033_18562_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=1351 data-flex-basis=3244px></p></li><li><p>GEOIP <em>no-resolve && DOMAIN,</em> REQUEST GET <code>api.dida365.com</code> + <code>api.dida36768990.com</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>119.29.29.29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida365.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;api.dida36768990.com&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>180.76.76.76</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,DIRECT,no-resolve</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida36768990.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN,api.dida365.com,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è·³è¿‡ã€Œè®¿é—®åŸŸåé‡åˆ° GEOIP è§„åˆ™æœ¬è¯¥è¿›è¡Œçš„æœ¬åœ° DNS è§£æã€ç›´æ¥è¿›å…¥ä¸‹ä¸€ä¸ªè§„åˆ™é›†çš„åŒ¹é…ï¼Œæ¥ä¸‹æ¥çš„ä¸¤æ¡<strong>ç›´è¿åŸŸåè§„åˆ™</strong>çš„æƒ…å†µå±äºå·²è®¨è®ºè¿‡çš„æ­£å¸¸æƒ…å†µï¼Œä¹Ÿå³ï¼Œå‘èµ·æœ¬åœ° DNS è¯·æ±‚ã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715193647978.png width=1460 height=407 srcset="/p/dive-into-clash-dns/image-20230715193647978_hu67870031026e59b44c3eba42446defdc_575102_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193647978_hu67870031026e59b44c3eba42446defdc_575102_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=358 data-flex-basis=860px></p></li><li><p>è§„åˆ™æ¨¡å¼ - å‘å…¨å±€è¿‡æ¸¡</p><p>ä¿®æ”¹ rules</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/dive-into-clash-dns/image-20230715193704407.png width=1460 height=96 srcset="/p/dive-into-clash-dns/image-20230715193704407_hub76f8e495285eacea77f5471c597eac7_17848_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193704407_hub76f8e495285eacea77f5471c597eac7_17848_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=1520 data-flex-basis=3650px></p><p><img src=/p/dive-into-clash-dns/image-20230715193711612.png width=1460 height=490 srcset="/p/dive-into-clash-dns/image-20230715193711612_hu3f820a12da0ac190aa52f04559d24a69_91050_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193711612_hu3f820a12da0ac190aa52f04559d24a69_91050_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=297 data-flex-basis=715px></p><p>è¿™è¿‘ä¼¼äºå…¨å±€ï¼ˆä»£ç†ï¼‰æ¨¡å¼ï¼Œæ‰€æœ‰ç»ç”± clash çš„è¯·æ±‚éƒ½è¢«å‘ˆé€’åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ŒDNSè§£æç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆï¼Œæœ¬åœ°æ‰«ä¸åˆ°ç»ç”± clash DNS çš„è¯·æ±‚çºªå½•ã€‚</p><h4 id=å…¨å±€æ¨¡å¼---å…¨å±€ä»£ç†å…¨å±€ç›´è¿ä¸å…¨å±€æ‹’ç»>å…¨å±€æ¨¡å¼ - å…¨å±€ä»£ç†ï¼Œå…¨å±€ç›´è¿ä¸å…¨å±€æ‹’ç»</h4><p>è¯¥æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ‰€æœ‰è¯·æ±‚éƒ½ ä»£ç†/DIRECT/REJECTã€‚å…¶ä¸­ï¼Œä»£ç†å¯ä»¥ç»†åˆ†ä¸ºæŸä¸ªä»£ç†ç»„æˆ–æŸä¸ªä»£ç†èŠ‚ç‚¹ã€‚</p><p><em><strong>ä»£ç†</strong></em>ï¼šæ‰€æœ‰ç»ç”± clash çš„è¯·æ±‚éƒ½è¢«å‘ˆé€’åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼ŒDNSè§£æç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆï¼Œæœ¬åœ°æ‰«ä¸åˆ° DNS è¯·æ±‚çºªå½•ã€‚å…·ä½“ç”±å“ªä¸ªæœåŠ¡å™¨å¤„ç†è¯·æ±‚å–å†³äºä½ çš„é…ç½®ã€‚</p><p><em><strong>DIRECT</strong></em>ï¼šæ‰€æœ‰ç»ç”± clash çš„è¯·æ±‚éƒ½ä»æœ¬åœ°å‘å‡ºï¼ŒDNSè§£æè¡Œä¸ºç”± dns å­—æ®µå®šä¹‰çš„ç­–ç•¥å†³å®šï¼Œæœ¬åœ°å¯ä»¥æ‰«åˆ°æœªåŠ å¯†çš„çºªå½•ã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715193735385.png width=1460 height=193 srcset="/p/dive-into-clash-dns/image-20230715193735385_hua739caf696c3c3288b1a1e9964c5668e_261736_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715193735385_hua739caf696c3c3288b1a1e9964c5668e_261736_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=756 data-flex-basis=1815px></p><p><em><strong>REJECT</strong></em>: æ‰€æœ‰ç»ç”± clash çš„è¯·æ±‚éƒ½è¢«ç”©å…¥é»‘æ´ï¼Œæ­¤æ—¶ä½ è®¿é—®ä»»ä½•ç½‘ç«™éƒ½ä¼šæ˜¾ç¤º <em>ERR_CONNECTION_CLOSED</em> çš„è­¦å‘Šï¼Œè™½ç„¶è¿™å¹¶ä¸æ„å‘³ç€ä½ æ²¡æ³•ä¸Šç½‘ï¼Œä½†è‡³å°‘ä½ æµè§ˆå™¨æ˜¯æ²¡æ³•ç”¨äº†ã€‚ğŸ¥¹åŒå…¨å±€ä»£ç†ï¼Œæ­¤æ—¶ DNS é…ç½®ä¸èµ·ä½œç”¨ã€‚</p><p>å¦‚æœä¸ä¸Šä¸€èŠ‚å†…å®¹ä½œæ¯”è¾ƒï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>MATCH,PROXY </span><span class=w> </span><span class=c># å…¨å±€ä»£ç†ï¼ˆä½¿ç”¨åä¸º PROXY çš„ä»£ç†ç»„ï¼‰</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>MATCH,DIRECT</span><span class=w> </span><span class=c># å…¨å±€ç›´è¿</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>MATCH,REJECT</span><span class=w> </span><span class=c># å…¨å±€æ‹’ç»</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>Best Practices - DNS åˆ†æµé…ç½®</p><p>æƒ³å•¥å‘¢ğŸƒæ‰å¼€å§‹è¿›é˜¶æ€ä¹ˆä¼šæœ‰æœ€ä½³å®è·µé…ç½®</p><p>æƒ³å•¥å‘¢ğŸ§æˆ‘ä»¬è¿˜æ²¡å¼€å§‹ <strong>&lt;å›°éš¾></strong> å’Œ <strong></strong>ç« èŠ‚å†…å®¹çš„ä»‹ç»~</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬æ˜¯æ—¶å€™æ¥ä¸ªé˜¶æ®µæ€§çš„æœ€ä½³å®è·µæ€»ç»“äº†ï¼Œåç»­ä»‹ç»çš„å†…å®¹ä¹Ÿä¸ä¼šå’Œå¦‚ä¸‹ç»“è®ºå†²çªã€‚</p><ol><li><p>ç¼–æ’ rules è§„åˆ™æ—¶ï¼Œå…ˆå†™åŸŸååŒ¹é…å†å†™ IP åŒ¹é…ï¼Œæœ€å <code>MATCH</code> å…œåº•ã€‚</p><p>é»˜è®¤å‡ºç«™é€‰æ‹© PROXY è¿˜æ˜¯ DIRECT å–å†³äºä½ çš„æ€§ç™–ä¸Šç½‘ä¹ æƒ¯ï¼Œè¿›è€Œå†³å®šé€‰æ‹© ç™½åå• è¿˜æ˜¯ é»‘åå• çš„ç¼–æ’æ–¹æ¡ˆã€‚</p><ul><li><code>MATCH,PROXY</code> å…œåº•ï¼Œå»ºè®®éµä»å¦‚ä¸Š rules æœ€ä½³å®è·µçš„å‰æä¸‹ï¼Œå…ˆç¼–æ’ PROXY å‡ºç«™è§„åˆ™å†ç¼–æ’ DIRECT å‡ºç«™è§„åˆ™</li><li><code>MATCH,DIRECT</code> å…œåº•ï¼Œåä¹‹ã€‚</li></ul></li><li><p>ä¼˜å…ˆä½¿ç”¨ RULE-SETï¼Œåªéœ€æ·»åŠ æœªåœ¨ä¸Šæ¸¸è§„åˆ™é›†ä¸­å‡ºç°çš„è§„åˆ™ã€‚</p><p>å°½ç®¡ç›®å‰è¿™äº›è§„åˆ™é›†è‡³å°‘æœ‰å‡ åä¸‡æ¡æ•°æ®ï¼Œä½†åœ¨ç²¾å¿ƒè®¾è®¡çš„ Mapping ç­–ç•¥ä¸‹ï¼Œè§„åˆ™åŒ¹é…çš„è€—æ—¶æ˜¯å¿½ç•¥ä¸è®¡çš„ã€‚</p><p>æ­¤å¤–ï¼Œä½ å¯èƒ½éœ€è¦å°†è¿™æ¡è§„åˆ™ <code>RULE-SET,applications,DIRECT</code> æ·»åŠ åˆ°ä½ çš„ rules é¦–è¡Œã€‚</p></li><li><p>å½“è®¿é—®åŸŸåé‡åˆ° <strong>IP è§„åˆ™</strong> æˆ– <strong>åŸŸåç›´è¿è§„åˆ™</strong>æ—¶ï¼Œæœ¬åœ°å‘èµ· DNS è¯·æ±‚ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ æ·»åŠ çš„ classical RULE-SET å¯èƒ½ä¹ŸåŒ…å«åŸŸåç›´è¿è§„åˆ™ä»¥åŠ IP è§„åˆ™</p></li><li><p>clash DNS Mapping</p><ul><li>ä½¿ç”¨ <em>nameserver-policy</em> å’Œ <em>nameserver</em> è§£ææˆ‘ä»¬å³å°†è®¿é—®çš„åŸŸåï¼Œå‰è€…ä¼˜å…ˆå¯åŠ¨ã€‚</li><li>éœ€è¦ä½¿ç”¨ <em>default-nameserver</em> è§£æä¸Šè¿°ä¸¤ä¸ªç­–ç•¥ç»„ä¸­çš„åŸŸåï¼Œä¹Ÿå³ï¼Œ<em>default-nameserver</em> éœ€è¦ä½¿ç”¨ IP å†™æ³•ï¼ˆå¯ä»¥æ˜¯ IP å½¢å¼çš„ DOHï¼‰ï¼Œé¿å…å‡ºç°é¸¡è›‹é—®é¢˜ã€‚</li><li>è¿™ä¸‰ä¸ªç­–ç•¥ç»„çš„ç½‘ç»œè¯·æ±‚æ˜¯å¹¶å‘è¡Œè¿›çš„ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå¹¶å‘æŸ¥è¯¢ï¼Œclash ä¼˜å…ˆé‡‡ç”¨æœ€é€Ÿå“åº”çš„ IP ä½œä¸ºåŸŸåçš„æŸ¥è¯¢ç»“æœã€‚</li><li>ä¸å¿…ä¿®æ”¹ï¼ˆè¦†ç›–ï¼‰é»˜è®¤çš„ <em>default-nameserver</em>ï¼Œè€Œ <em>nameserver-policy</em> å’Œ <em>nameserver</em> å°½å¯èƒ½ä½¿ç”¨ IP å½¢å¼çš„ DOHï¼Œçœå»è¿™ä¸ªé—´æ¥çš„è§£ææ­¥éª¤ã€‚</li><li>åœ¨è®¾ç½® <em>nameserver-policy</em> å’Œ <em>nameserver</em> æ—¶ä½¿ç”¨ DOHï¼Œè€Œé DOT/DOQã€‚</li></ul></li></ol><p>æˆ‘ä»¬å¯ä»¥å‡­å€Ÿä¸Šè¿°ç‰¹æ€§ç»„åˆå‡ºã€Œå›½å¤–DNSã€å’Œã€Œç›´è¿DNSã€çš„æ¦‚å¿µï¼Œä½ å¯ä»¥è¯´è¿™æ˜¯ä¸€ä¸ªç²¾å¦™çš„å·§åˆï¼Œä½†ä¹Ÿå¯ä»¥è¯´è¿™æ˜¯ç¤¾åŒºæ™ºæ…§çš„ç»“æ™¶ã€‚</p><h4 id=public-dns---å·²çŸ¥çš„-dns-æä¾›å•†>Public DNS - å·²çŸ¥çš„ DNS æä¾›å•†</h4><ul><li><p><a class=link href=https://github.com/QIN2DIM/tuic-installer/wiki/%e5%85%ac%e6%9c%89-DNS-%e6%b1%87%e6%80%bb-DOT-DOH-DOQ target=_blank rel=noopener>å…¬æœ‰ DNS æ±‡æ€» DOT DOH DOQ Â· QIN2DIM/tuic-installer</a></p></li><li><p><a class=link href=https://adguard-dns.io/kb/zh-CN/general/dns-providers/#default target=_blank rel=noopener>å·²çŸ¥çš„ DNS æä¾›å•† | AdGuard DNS Knowledge Base</a></p></li></ul></li></ul><h2 id=åŸç†ç¯‡>åŸç†ç¯‡</h2><blockquote><p>ğŸ’¡Let&rsquo;s analyze this systematically.</p></blockquote><h3 id=clash-flow---dns>Clash flow - DNS</h3><p>æµç¨‹å›¾</p><h3 id=clash-flow---proxy>Clash flow - Proxy</h3><p>æµç¨‹å›¾</p><h2 id=æ³„æ¼ç¯‡>æ³„æ¼ç¯‡</h2><h3 id=dns-æ³„æ¼---æ¦‚å¿µç•Œå®š>DNS æ³„æ¼ - æ¦‚å¿µç•Œå®š</h3><ol><li>ç”¨æˆ·å¼€å¯ VPN åï¼Œæ­£å¸¸ç½‘ä¸Šå†²æµªäº§ç”Ÿçš„ DNS è¯·æ±‚è¢« <strong>æœ¬åœ°</strong> ä¸Šæ¸¸ ISP æ•è·ã€‚</li><li>å› æ­¤ï¼Œæœ¬åœ°ä¸Šæ¸¸ ISP çŸ¥é“ <strong>&lt;æŸäºº></strong> è¦è§£æçš„ <strong>&lt;æŸåŸŸå></strong> ã€‚</li></ol><h3 id=dns-æ³„æ¼---äº‰è®®ç‚¹>DNS æ³„æ¼ - äº‰è®®ç‚¹</h3><h4 id=vpn-çš„-dns-æ³„æ¼>VPN çš„ DNS æ³„æ¼</h4><p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¼€å¯ VPN åï¼ŒVPN è½¯ä»¶å°†ç”¨æˆ·çš„ã€Œè®¿é—®è¯·æ±‚ã€å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œè®¿é—®ç½‘ç«™çš„å·¥ä½œç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆï¼Œä¹Ÿå³ï¼ŒDNS è¯·æ±‚ç”±è¿œç¨‹æœåŠ¡å™¨å‘å‡ºã€‚</p><p>æ­¤æ—¶å‡ºç°äº†ä¸€äº›ä¸å¯æŠ—åŠ›å› ç´ ï¼Œç”¨æˆ·å‘ç›®æ ‡ç½‘ç«™å‘èµ·äº†ç›´è¿è¯·æ±‚ï¼Œæˆ–è€…è¯´ï¼Œæœ¬åœ°å‘èµ·äº†å‘ã€Œç³»ç»Ÿç½‘å…³ â†’ ä¸Šæ¸¸ ISPã€çš„ DNS æŸ¥è¯¢ã€‚æœ‰å¯èƒ½æ˜¯ VPN è½¯ä»¶æ²¡æœ‰åŠ«æŒåˆ°è¿™ä¸ªè¯·æ±‚ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç”¨æˆ·é…ç½®å‡ºäº†é—®é¢˜ï¼Œæ€»ä¹‹å°±æ˜¯ DNS è¯·æ±‚ä¸ä»…å‘å¾€äº† VPN æä¾›çš„ DNS ï¼Œä¹Ÿå‘å¾€äº†æœ¬åœ° ISPã€‚</p><p>In the caseï¼Œå°½ç®¡ä½ é…ç½®äº† DOHï¼Œä½†ä½œä¸ºè§£æ DNS è¯·æ±‚çš„ä¸Šæ¸¸ ISP å®ƒå¿…ç„¶æ˜¯èƒ½çœ‹åˆ°ä½ è¦è®¿é—®çš„ ç½‘å€ï¼ˆåŸŸåï¼‰ï¼Œä¸ç„¶å®ƒæ²¡æ³•ç»™ä½ æŸ¥è¯¢åŸŸåå¯¹åº”çš„ IPï¼ˆDNSåŸºæœ¬åŸç†ä¸è¿‡å¤šèµ˜è¿°ï¼‰ã€‚</p><h4 id=proxy-çš„-dns-æ³„æ¼>Proxy çš„ DNS æ³„æ¼</h4><p>clash ç­‰ä»£ç†æ ¸å¿ƒå‡ºç°äº†è§„åˆ™æ¨¡å¼çš„è®¾å®šï¼Œåœ¨åˆç†çš„é…ç½®ä¸‹ï¼š</p><ol><li>è®¿é—®å›½å†…ç«™ç‚¹ï¼ˆå¦‚ <code>geosite:cn</code>ï¼‰ï¼Œç›´æ¥ä»æœ¬æœºå‘èµ·è¯·æ±‚ã€‚</li><li>è®¿é—®æˆ‘ä»¬æ ‡è®°çš„ç«™ç‚¹ï¼ˆå¦‚ youtubeï¼‰ï¼Œåˆ™å°†è¯·æ±‚å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œä»£ç†è®¿é—®ã€‚</li></ol><p>ç»å¤§å¤šæ•°ç©å®¶ä½¿ç”¨çš„éƒ½æ˜¯è§„åˆ™æ¨¡å¼ä¸‹çš„ç³»ç»Ÿä»£ç†ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>DOMAIN-SUFFIX,youtube.com,PROXY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,CN,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;geosite:cn&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;https://223.5.5.5/dns-query&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>åœ¨è¿™ç§å¸¸è§é…ç½®ä¸‹ï¼Œæˆ‘ä»¬ç›´è¿è®¿é—®å›½å†…ç«™ç‚¹ï¼ˆå¦‚ bilibiliï¼‰æ‰€äº§ç”Ÿçš„ DNS è¯·æ±‚ï¼Œå¿…ç„¶è¢«<strong>å›½å†…DNS</strong> æä¾›å•†æ•è·ã€‚è¿™ç§ç®— <strong>DNS æ³„æ¼</strong> å—ï¼Ÿæˆ‘è§‰å¾—ä¸ç®—ã€‚</p><p>æ ¹æ®æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„å®šä¹‰ï¼Œ<strong>DNSæ³„æ¼æŒ‡çš„æ˜¯æˆ‘ä»¬ä½¿ç”¨ä»£ç†è®¿é—® <code>www.youtube.com</code> ï¼Œå´ä»æœ¬åœ°å‘é€ DNS è¯·æ±‚åˆ°å›½å†… ISP æŸ¥è¯¢ <code>www.youtube.com</code> å¯¹åº”çš„ IP ï¼Œå› æ­¤ä¸Šæ¸¸çŸ¥é“äº†ä½ æ›¾è®¿é—®æ²¹ç®¡ã€‚</strong></p><p>æ˜¾ç„¶ï¼Œåœ¨é…ç½®æ­£ç¡®çš„æƒ…å†µä¸‹ä¸å¯èƒ½å‡ºç°è¿™ç§äº‹æ•… æ ¹æ®æˆ‘ä»¬ä¸Šæ–‡çš„å®éªŒç»“è®ºï¼ŒåŸŸåè¯·æ±‚é‡åˆ°åŸŸåè§„åˆ™ï¼Œå‘½ä¸­è§„åˆ™åï¼Œå¦‚æœæ˜¯ä»£ç†å‡ºç«™ï¼Œæˆ‘ä»¬ä¼šå°†è®¿é—®è¯·æ±‚å‘ˆé€è‡³è¿œç¨‹æœåŠ¡å™¨ï¼ŒDNS æŸ¥è¯¢ç”±è¿œç¨‹æœåŠ¡å™¨å®Œæˆã€‚</p><p>ä¹Ÿå³ï¼Œå½“ä½ é…ç½®äº† <code>DOMAIN-SUFFIX,youtube.com,PROXY</code> è¿™æ¡è§„åˆ™æ—¶ï¼Œæœ¬åœ°ä¸ä¼šå‘èµ·å¯¹ <code>+.youtube.com</code> çš„åŸŸåè§£æã€‚ï¼ˆå‡è®¾å·²ç¦ç”¨DNSç­–ç•¥ç»„ï¼‰</p><p>è¿™ä¸æˆ‘ä»¬å…ˆå‰æåˆ°çš„ VPN è¡Œä¸ºæ¨¡å¼ä¸åŒã€‚æˆ‘ä»¬çš„æ„å›¾åœ¨äºï¼š</p><ol><li>æˆ‘ä»¬å¯ç”¨äº†è§„åˆ™æ¨¡å¼ï¼Œæ—¨åœ¨é¿å…è¿œç¨‹æœåŠ¡å™¨å¤„ç†æˆ‘ä»¬å¯¹å›½å†…ç½‘ç«™çš„è®¿é—®è¯·æ±‚ã€‚æˆ‘ä»¬å¸Œæœ›è®¿é—®å›½å†…ç½‘ç«™è€Œä»æœ¬åœ°å‘èµ·çš„ ã€ŒDNS è¯·æ±‚ã€ç»è¿‡æœ¬åœ°è¿è¥å•†ï¼Œä»¥æ­¤è·å¾—æ›´ä½çš„ç½‘ç»œå»¶è¿Ÿã€‚</li><li>ä¸å¸Œæœ›æœ¬åœ°è¿è¥å•†æ•è·åˆ°æˆ‘ä»¬å¯¹æ ‡è®°ç½‘ç‚¹ï¼ˆå¦‚ <code>www.youtube.com</code>ï¼‰çš„è®¿é—®è¯·æ±‚ã€‚</li></ol><p>æ¢å¥è¯è¯´ï¼Œä¸€ä¸ª DNS è¯·æ±‚è¿‡æ¥ï¼Œè¿è¥å•†å¿…ç„¶çŸ¥é“æœ‰äººæ­£åœ¨è®¿é—® <code>www.youtube.com</code>ï¼Œè€Œä»£ç†è®¿é—®çš„æœ¬è´¨åœ¨äºä¸è®©è¿è¥å•†çŸ¥é“è®¿å®¢çš„çœŸå®èº«ä»½ã€‚</p><h3 id=dns-æ³„æ¼---æ£€æµ‹å·¥å…·>DNS æ³„æ¼ - æ£€æµ‹å·¥å…·</h3><ul><li><p><a class=link href=https://browserleaks.com/ip target=_blank rel=noopener>My IP Address - BrowserLeaks</a></p></li><li><p><a class=link href=https://ipleak.net/ target=_blank rel=noopener>IP/DNS Detect - What is your IP, what is your DNS, what informations you send to websites. (ipleak.net)</a></p></li></ul><h3 id=dns-æ³„æ¼---æ£€æµ‹åŸç†>DNS æ³„æ¼ - æ£€æµ‹åŸç†</h3><p>å¦‚æœä½ è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ DNS æ³„æ¼å¯ä»¥ä»å‰æ–‡çœ‹èµ·ï¼Œæ³„æ¼çš„å®šä¹‰å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><ol><li>âœ…ç›´è¿è®¿é—® <a class=link href=http://bilibili.com target=_blank rel=noopener>bilibili.com</a> ï¼Œç”±æœ¬åœ° PC å‘ä¸Šæ¸¸ DNS å‘é€æŸ¥è¯¢</li><li>âœ…ä»£ç†è®¿é—® <a class=link href=http://google.com target=_blank rel=noopener>google.com</a>ï¼Œç”±è¿œç¨‹æœåŠ¡å™¨å‘å›½å¤– DNS å‘é€æŸ¥è¯¢</li><li>âŒä»£ç†è®¿é—® <a class=link href=http://google.com target=_blank rel=noopener>google.com</a>ï¼Œç”±æœ¬åœ° PC å‘ä¸Šæ¸¸ DNS å‘é€æŸ¥è¯¢</li></ol><p><img src=/p/dive-into-clash-dns/image-20230715195243552.png width=1460 height=772 srcset="/p/dive-into-clash-dns/image-20230715195243552_hu966c9fbc6ce7f3424ae165e5d9422d58_436671_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715195243552_hu966c9fbc6ce7f3424ae165e5d9422d58_436671_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=189 data-flex-basis=453px></p><p>å®éªŒå¼€å§‹å‰ï¼Œç¼–æ’å¦‚ä¸‹è§„åˆ™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dns</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enable</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>223.5.5.5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>nameserver-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s2>&#34;ipleak.net&#34;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>1.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,CN,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOIP,CN,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>MATCH,PROXY</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä»¥ <a class=link href=https://ipleak.net target=_blank rel=noopener>ipleak.net</a> çˆ²ä¾‹è¯´æ˜ DNS æ³„æ¼æ£€æµ‹çš„å·¥ä½œåŸç†ã€‚</p><p>å½“ä½ è®¿é—® DNS æ³„æ¼æ£€æµ‹çš„ç«™ç‚¹åï¼Œå‘ç”Ÿäº†å¦‚ä¸‹äº‹ä»¶ï¼š</p><ol><li><p><code>ipleak.net</code> åç«¯æœåŠ¡å™¨å‘å‰ç«¯é¡µé¢ä¸æ–­æ¨é€æ–°çš„æ•°æ®åŒ…ï¼Œè¿™äº›æ•°æ®åŒ…çš„ Request URL éƒ½æ˜¯ <code>+.ipleak.net</code> å½¢å¼ï¼Œä¾‹å¦‚ï¼š</p><p><img src=/p/dive-into-clash-dns/image-20230715195310133.png width=1460 height=346 srcset="/p/dive-into-clash-dns/image-20230715195310133_hu289f06ccb641c26a062a4aa1c2061a82_159612_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715195310133_hu289f06ccb641c26a062a4aa1c2061a82_159612_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=421 data-flex-basis=1012px></p></li><li><p>æµè§ˆå™¨å‘èµ· Requestå¹¶æ„é€  DNS è¯·æ±‚æŸ¥è¯¢è¿™äº›åŸŸåå¯¹åº”çš„ IP</p><p>è™½ç„¶è¿™äº›åŸŸåæ˜¯éšæœºç”Ÿæˆçš„ï¼Œä½†å®ƒä»¬éƒ½è¢«æ­£ç¡®è§£æåˆ°æœ‰æ•ˆçš„åç«¯ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ DNS æŸ¥è¯¢åˆ° Request Domain å¯¹åº”çš„ï¼ˆCDNï¼‰IPã€‚</p><p><img src=/p/dive-into-clash-dns/image-20230715195319858.png width=1460 height=417 srcset="/p/dive-into-clash-dns/image-20230715195319858_hu12ef14c98df114824b87e431a300c211_616831_480x0_resize_box_3.png 480w, /p/dive-into-clash-dns/image-20230715195319858_hu12ef14c98df114824b87e431a300c211_616831_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=350 data-flex-basis=840px></p><p>æ˜¾ç„¶ï¼Œè¿™äº›éšæœºç”Ÿæˆçš„åŸŸåä¸å¯èƒ½å­˜åœ¨äºä»»ä½• GEOSITEï¼ŒRULE-SET æ•°æ®åº“ä¸­ï¼ˆé¡¹ç›®ç»´æŠ¤è€…ä¹Ÿä¸ä¼šæ·»åŠ è¿™äº›ç‰¹æ®Šçš„åŸŸåï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›è®¿é—®è¯·æ±‚è¿›å…¥ clash åï¼Œèµ°çš„ä¸€å®šæ˜¯å…œåº•çš„ <code>MATCH,PROXY</code> è§„åˆ™ï¼ˆé™¤éä½ æŠŠ <code>ipleak.net</code> è¿™ä¸ªåŸŸåé…ç½®åˆ°è§„åˆ™é‡Œäº†ğŸ¥¹ï¼‰ã€‚</p><p>æˆ‘ä»¬é€šå¸¸ä¼šæŠŠå…œåº•è§„åˆ™å†™åœ¨æœ€åä¸€è¡Œï¼Œæ„å‘³ç€æ¯ä¸ªè®¿é—®è¯·æ±‚éƒ½ä¼šæŠŠä½ çš„ <em>rules</em> æ‰«ä¸€éã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ²¿é€”é‡åˆ°çš„é¦–æ¡ IP è§„åˆ™ï¼ˆä¾‹å¦‚æˆ‘ä»¬é…ç½®çš„ <code>GEOIP</code>ï¼‰ä¼šè§¦å‘æœ¬åœ° DNS è§£æï¼Œã€Œä½ é…ç½®çš„ DNS çš„ä¸Šæ¸¸DNSã€ä»¥åŠæœ€ç»ˆæµå‘çš„ã€Œæƒå¨åŸŸåæœåŠ¡å™¨ã€çš„ Server IP ä¼šè¢«åŸŸåæ£€æµ‹ç½‘ç«™è®°å½•ä¸‹æ¥ï¼Œæœ€ç»ˆæ‰“å°åˆ°å‰ç«¯é¡µé¢ä¸Šã€‚</p><p>è®¿é—®è¯·æ±‚æœ€åå‘½ä¸­ <code>MATCH,PROXY</code> ä»£ç†å‡ºç«™è§„åˆ™ï¼Œæ‰€ä»¥è¿œç¨‹æœåŠ¡å™¨å¿…ç„¶å‘èµ· DNS æŸ¥è¯¢è¯·æ±‚ï¼Œä¹Ÿå³ï¼Œåœ¨å¼€å¯ä»£ç†çš„æƒ…å†µä¸‹ï¼Œå‰ç«¯é¡µé¢ä¼šæ‰“å°å‡ºè½åœ°æœºæ‰€åœ¨åŒºåŸŸçš„å›½æ——ä»¥åŠè½åœ°æœºä¸Šæ¸¸ ISP DNS ä¿¡æ¯ ã€‚</p></li><li><p>ç›´è¿è®¿é—® - æ­£å¸¸æƒ…å†µ</p><p>å¦‚æœä½ æ²¡ç†è§£æˆ‘åˆšè¯´çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥å°è¯•ä¸ä½¿ç”¨ä»£ç†ç›´æ¥è®¿é—® <code>ipleak.net</code>ï¼Œä½ å¯ä»¥çœ‹åˆ°é¡µé¢è¢«å›½æ——åˆ·å±äº†ã€‚è¿™äº› IP æ¥è‡ªä½ é€‰ç”¨çš„ DNS ä»¥åŠä½ ä¸Šæ¸¸çš„ ISP DNSã€‚</p></li><li><p>ä»£ç†è®¿é—® - æ­£å¸¸æƒ…å†µ</p><p>DNS è¯·æ±‚ç”±è¿œç¨‹æœåŠ¡å™¨å‘èµ·ï¼Œè¿œç¨‹æœåŠ¡å™¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç³»ç»Ÿ DNS å’Œä¸Šæ¸¸ ISPï¼Œåœ¨æ²¡æœ‰ç‰¹æ®Šè®¾è®¡ç½‘å…³çš„æƒ…å†µä¸‹ï¼Œä½ èƒ½çœ‹åˆ° <code>ipleak.net</code> é¡µé¢ä¸Šä¸æ–­åˆ·å‡ºè¿œç¨‹æœåŠ¡å™¨æ‰€åœ¨åœ°åŒºçš„å›½æ——ä»¥åŠç”±è¿œç¨‹æœåŠ¡å™¨å‘èµ·çš„ DNS è¯·æ±‚ç»è¿‡çš„ server IPã€‚</p><p>å¦‚æœä½ çš„è¿œç¨‹æœåŠ¡å™¨ç½‘ç»œç¯å¢ƒæ¯”è¾ƒç‰¹æ®Šï¼Œä½ ä¼šçœ‹åˆ°æ¥è‡ªå¤šä¸ªå›½å®¶å’Œåœ°åŒºçš„ server IPã€‚</p></li><li><p>ä»£ç†è®¿é—® - å¼‚å¸¸æƒ…å†µ</p><p>å¦‚æœæ£€æµ‹ç«™ç‚¹èƒ½å¤Ÿé€šè¿‡è®°å½• DNS server IP çš„æ–¹å¼è¿”å›å‘é€ç«¯ PC çš„çœŸå®æ‰€åœ¨åœ°ï¼Œè¯´æ˜å‘ç”Ÿäº† DNS æ³„æ¼ã€‚</p><p><strong>è¿™é‡ŒåŠ äº†è¶…é•¿çš„å®šè¯­ï¼š</strong></p><ul><li>âœ…æœ¬åœ°æ²¡æœ‰å‘èµ· DNS æŸ¥è¯¢ï¼Œä¸å¯èƒ½å­˜åœ¨æ³„æ¼</li><li>ğŸš«æœ¬åœ°å‘èµ· DNS æŸ¥è¯¢ï¼Œä½¿ç”¨ç³»ç»Ÿ DNS æˆ–å›½å†… DNSï¼Œèƒ½å¤Ÿé€šè¿‡ä¸‰è¦ç´ å®šä½è¿˜åŸå‡º zero å‘é€ç«¯çš„å¤§è‡´ä½ç½®ã€‚ä¾‹å¦‚ <code>ipleak.net</code> ç­‰å…¬æœ‰æœåŠ¡æä¾›çš„ç²—ç³™å®šä½èƒ½å¤Ÿæ˜¾ç¤ºå›½æ——ï¼Œä½†æ˜¾ç„¶æœ‰æ›´ç²¾å¯†çš„æŠ€æœ¯èƒ½å¤Ÿåšåˆ°ç»çº¬åº¦çº§åˆ«çš„å®šä½ã€‚</li><li>ğŸ‘ï¸â€ğŸ—¨ï¸æœ¬åœ°å‘èµ· DNS æŸ¥è¯¢ï¼Œä½†ä½¿ç”¨çš„æ˜¯ç»è¿‡ç‰¹æ®Šè®¾è®¡çš„ DNS æˆ–å…¶ä»–åœ°åŒºçš„ DNSï¼Œä¸èƒ½æˆ–å‡ ä¹ä¸å¯èƒ½é€šè¿‡ä¸‰è¦ç´ å®šä½è¿˜åŸå‡º zero å‘é€ç«¯çš„å¤§è‡´ä½ç½®ã€‚</li></ul><p>ğŸŒ€<strong>è¿·æ€ä¸äº‰è®®ï¼š</strong></p><ol><li><p><strong><code>ipleak.net</code>å‡ºç°äº†å›½æ——ï¼Œæˆ‘çš„é…ç½®å‡ºç°è‡´å‘½é”™è¯¯äº†å—ï¼Ÿ</strong></p><p><code>ipleak.net</code> å‡ºç°äº†ä½ æ‰€åœ¨åœ°çš„å›½æ——ï¼Œå¹¶ä¸ä»£è¡¨ä½ è®¿é—® youtube google çš„è¯·æ±‚ä¼šè¢«æœ¬åœ°è¿è¥å•†æˆªè·ã€‚æˆ‘ä»¬ä¸Šæ–‡æåˆ°è¿‡ï¼ˆå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æœ¬æ–‡æåˆ°çš„é…ç½®æˆ–æ˜¯ <a class=link href=https://wiki.metacubex.one/example/#_2 target=_blank rel=noopener>meta æ‡’äººé…ç½®</a>ï¼‰ï¼Œç±»ä¼¼è®¿é—® youtube çš„è¯·æ±‚åœ¨ IP è§„åˆ™ä¹‹å‰å¿…ç„¶å‘½ä¸­ <em>PROXY</em> å‡ºç«™è§„åˆ™ï¼Œ æœ¬åœ°ä¸ä¼šäº§ç”Ÿå¯¹ <code>youtube.com</code> çš„ DNS è§£æè¯·æ±‚ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰è¢«æœ¬åœ°è¿è¥å•†æˆªè·è¿™ä¸€è¯´ã€‚</p><p>å¦‚æœä½ åªå…³æ³¨è®¿é—® youtube google ç­‰ç½‘ç«™çš„æ„å›¾æ•°æ®æ¼æ²¡æ¼ï¼Œé‚£ä½ è¢« <code>ipleak.net</code> ç­‰ä¸€ä¼—æ£€æµ‹ç«™ç‚¹çˆ†èŠäº†ä¹Ÿæ— ä¼¤å¤§é›…ã€‚</p><p>ä½†å¿…é¡»è¯´æ˜çš„æ˜¯ï¼Œå‡ºç°äº†å›½æ——ï¼Œè¯´æ˜ä½ å‘ä¸Šæ¸¸ ISP å‘èµ·äº†é’ˆå¯¹ã€Œæ„å¤–ç«™ç‚¹ã€çš„ DNS è¯·æ±‚ï¼Œipleak èƒ½å¤Ÿè¿˜åŸä½ çš„æ‰€åœ¨åœ°ï¼Œè¿™å±äº DNS æ³„æ¼çš„èŒƒç•´ã€‚ å¦‚æœæœ‰æŸä¸ªç½‘ç«™å€ŸåŠ© ipleak ç­‰æ£€æµ‹æœåŠ¡è¿½æº¯å‘é€ç«¯çš„å¤§è‡´æœåŠ¡åŒºï¼Œä½ å¤§æ¦‚ç‡ä¼šè¢«ç²¾ç¡®åˆ°å¸‚åŒºçº§è¿è¥å•†ã€‚</p></li><li><p><strong><code>ipleak.net</code>æ²¡æœ‰å‡ºç°å›½æ——ï¼Œæˆ‘çš„é…ç½®æ­£å¸¸å—ï¼Ÿ</strong></p><p>å¦‚æœä½ ç”¨çš„æ˜¯ VPNï¼Œä½ çš„é…ç½®æ­£å¸¸ã€‚ä½†ä½ ç”¨çš„æ˜¯ clashï¼Œè¿™ä¸ªé—®é¢˜å­˜åœ¨äº‰è®®ã€‚</p><p>ä¾‹å¦‚ï¼Œè®¿é—® <code>youtube.com</code> ä½† <em>rules</em> é‡Œå‡ºç°äº† <code>DOMAIN-SUFFIX,youtube.com,DIRECT</code> è¿™ç§å¥‡æ€ªçš„ä¸œè¥¿ï¼Œæˆ–è€…æå‰é‡åˆ°äº† IP è§„åˆ™ï¼Œé‚£ä¹ˆï¼Œæœ¬åœ°ä¼šå‘èµ· DNS è¯·æ±‚ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ <em>nameserver</em> ä¸­é…ç½®äº† <code>https://security.cloudflare-dns.com/dns-query</code> è¿™æ ·çš„å›½å¤–ï¼ˆæˆ–å…¶ä»–åœ°åŒºï¼‰çš„ DOHï¼Œæ³„æ¼æ£€æµ‹ç«™ç‚¹æ˜¯æ— æ³•è®°å½•åˆ°ä½ çš„çœŸå®æ‰€åœ¨åœ°çš„ã€‚</p><p>æ˜¾ç„¶ï¼Œè¿™ç§æƒ…å†µä¸æˆ‘ä»¬ç•Œå®šçš„ DNS æ³„æ¼æœ‰æ‰€å†²çªã€‚</p><p>å¹¿ä¹‰ä¸Šè®²ï¼Œè®¿é—®åº”è¯¥è¢«ä»£ç†çš„ç½‘ç«™çš„ DNS è¯·æ±‚å¿…é¡»ç”±è½åœ°ä»£ç†äº§ç”Ÿï¼Œè€ŒçœŸæ­£çš„å‘é€ç«¯è¢«éšè—èµ·æ¥ã€‚å¦‚æœä½ è®¤ä¸ºåªè¦è®¿é—®è¢«ä»£ç†çš„ç½‘ç«™æ—¶ï¼Œæœ¬åœ°å‘èµ·äº† DNS è¯·æ±‚å°±ç®—æ³„æ¼çš„è¯ï¼Œè¿™ç§æƒ…å†µå±äº DNS æ³„æ¼ï¼Œä½ çš„é…ç½®ä¸æ­£å¸¸ã€‚</p><p>ç‹­ä¹‰ä¸Šè®²ï¼Œå¦‚æœä½ è§‰å¾—å°½ç®¡æœ¬åœ°å‘èµ·äº† DNS è¯·æ±‚ï¼Œä½†åªè¦ä¸è¢«æ­£ç¡®æº¯æºå°±å¯ä»¥æ¥å—ã€‚é‚£ä¹ˆåœ¨å…¼é¡¾å»¶è¿Ÿå’Œå®‰å…¨çš„å‰æä¸‹ï¼Œé€‰æ‹©ç»è¿‡ç‰¹æ®Šè®¾è®¡çš„å¢ƒå¤– DOH / DOQ æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©<a class=link href="https://www.notion.so/Dive-into-Clash-DNS-a025c9bb5f724972a2ffb7984ae4a6ca?pvs=21" target=_blank rel=noopener>æŸ¥çœ‹å·²çŸ¥çš„å…å®¡æŸ¥å…¬æœ‰ DNS</a>ã€‚</p></li></ol></li></ol><h3 id=å¦‚ä½•é¿å…-dns-æ³„æ¼>å¦‚ä½•é¿å… DNS æ³„æ¼</h3><h2 id=è§¦ç±»æ—é€š>è§¦ç±»æ—é€š</h2><h3 id=tunnel-mode>TUNNEL Mode</h3><h3 id=enhanced-mode>Enhanced Mode</h3><h4 id=dnsmaping>DNSMaping</h4><h4 id=fakeip-clash--meta>FakeIP: Clash & Meta</h4><h4 id=fakedns-v2ray--sing-box>FakeDNS: v2ray & sing-box</h4><h4 id=l3-loss-but-deepin-magic>L3: Loss but deepin magic</h4><h3 id=è½¯è·¯ç”±---ç‰©ç†è¶…åº¦>è½¯è·¯ç”± - ç‰©ç†è¶…åº¦</h3><h2 id=ä¸€å¶çŸ¥ç§‹>ä¸€å¶çŸ¥ç§‹</h2><h3 id=å¤„ç†-squad-eac-åå¤–æŒ‚éªŒè¯>å¤„ç† Squad EAC åå¤–æŒ‚éªŒè¯</h3><h3 id=è§£é”æµåª’ä½“>è§£é”æµåª’ä½“</h3><h3 id=ç»•è¿‡-chatgpt-ç½‘ç»œå®¡æŸ¥>ç»•è¿‡ ChatGPT ç½‘ç»œå®¡æŸ¥</h3><h2 id=å¤©å¤–é£ä»™>å¤©å¤–é£ä»™</h2><h3 id=åŸºäº-rust-å®ç°-pbq-quic-based-æ‹¥å¡æ§åˆ¶ç®—æ³•>åŸºäº Rust å®ç° PBQ QUIC-based æ‹¥å¡æ§åˆ¶ç®—æ³•</h3><ul><li><p>Paper: <a class=link href=https://www.mdpi.com/1099-4300/25/2/294 target=_blank rel=noopener>ã€ŠPBQ-Enhanced QUIC: QUIC with Deep Reinforcement Learning Congestion Control Mechanismã€‹</a></p></li><li><p>PDF: <a class=link href=entropy-25-00294-v2.pdf>entropy-25-00294-v2.pdf</a></p></li></ul><h2 id=clashmeta-å‚è€ƒé…ç½®>Clash.Meta å‚è€ƒé…ç½®</h2><ol><li><a class=link href=https://wiki.metacubex.one/example/#_2 target=_blank rel=noopener>Meta å®˜æ–¹æä¾›çš„æ‡’äººé…ç½®</a></li><li><a class=link href=https://github.com/QIN2DIM/tuic-installer/wiki/Clash.Meta-configuration target=_blank rel=noopener>æœ¬ç¯‡åšå®¢çš„é™„ä»¶</a></li></ol><h2 id=whats-more>What&rsquo;s more</h2><h3 id=æœ¯è¯­è¡¨>æœ¯è¯­è¡¨</h3><ol><li><p>clash rules ç›´è¿ï¼Œä»£ç†ï¼Œæ‹’ç»</p></li><li><p>v2fly / sing-box rules ç›´è¿ï¼ˆç»•è¿‡ï¼‰ï¼Œä»£ç†ï¼Œé˜»æ­¢</p></li><li><p>DNS</p></li><li><p>Clash DNS</p><ol><li>nameserver-policy</li><li>default-nameserver</li><li>nameserver</li><li>proxy-server-nameserver</li><li>fake-ip enhancer<ul><li><a class=link href=https://www.hostinger.com/tutorials/fqdn#What_is_FQDN target=_blank rel=noopener>FQDN</a></li><li>FakeIP Pool</li></ul></li></ol></li><li><p>DNS leak</p><p>æ¦‚å¿µç•Œå®šï¼šå¹¿ä¹‰ã€ç‹­ä¹‰</p><ul><li><a class=link href=http://ipleak.net/ target=_blank rel=noopener>http://ipleak.net/</a></li><li><a class=link href=https://browserleaks.com/ip target=_blank rel=noopener>https://browserleaks.com/ip</a></li></ul></li><li><p>DOH / DOT / DOQ / ODOH</p><ul><li><a class=link href=https://adguard-dns.io/en/blog/dns-over-quic.html target=_blank rel=noopener>https://adguard-dns.io/en/blog/dns-over-quic.html</a></li></ul></li></ol><h3 id=æºç é˜…è¯»>æºç é˜…è¯»</h3><h4 id=åˆå§‹åŒ–é…ç½®>åˆå§‹åŒ–é…ç½®</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UnmarshalRawConfig</span><span class=p>(</span><span class=nx>buf</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>RawConfig</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// config with default value
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>rawCfg</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>RawConfig</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>AllowLan</span><span class=p>:</span>        <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>BindAddress</span><span class=p>:</span>     <span class=s>&#34;*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>IPv6</span><span class=p>:</span>            <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Mode</span><span class=p>:</span>            <span class=nx>T</span><span class=p>.</span><span class=nx>Rule</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>GeodataMode</span><span class=p>:</span>     <span class=nx>C</span><span class=p>.</span><span class=nx>GeodataMode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>GeodataLoader</span><span class=p>:</span>   <span class=s>&#34;memconservative&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>UnifiedDelay</span><span class=p>:</span>    <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Authentication</span><span class=p>:</span>  <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>LogLevel</span><span class=p>:</span>        <span class=nx>log</span><span class=p>.</span><span class=nx>INFO</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Hosts</span><span class=p>:</span>           <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>any</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Rule</span><span class=p>:</span>            <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Proxy</span><span class=p>:</span>           <span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>any</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>ProxyGroup</span><span class=p>:</span>      <span class=p>[]</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>any</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=nx>TCPConcurrent</span><span class=p>:</span>   <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>FindProcessMode</span><span class=p>:</span> <span class=nx>P</span><span class=p>.</span><span class=nx>FindProcessStrict</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Tun</span><span class=p>:</span> <span class=nx>RawTun</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>              <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Device</span><span class=p>:</span>              <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Stack</span><span class=p>:</span>               <span class=nx>C</span><span class=p>.</span><span class=nx>TunGvisor</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>DNSHijack</span><span class=p>:</span>           <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;0.0.0.0:53&#34;</span><span class=p>},</span> <span class=c1>// default hijack all dns query
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>AutoRoute</span><span class=p>:</span>           <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>AutoDetectInterface</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Inet6Address</span><span class=p>:</span>        <span class=p>[]</span><span class=nx>LC</span><span class=p>.</span><span class=nx>ListenPrefix</span><span class=p>{</span><span class=nx>LC</span><span class=p>.</span><span class=nf>ListenPrefix</span><span class=p>(</span><span class=nx>netip</span><span class=p>.</span><span class=nf>MustParsePrefix</span><span class=p>(</span><span class=s>&#34;fdfe:dcba:9876::1/126&#34;</span><span class=p>))},</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>TuicServer</span><span class=p>:</span> <span class=nx>RawTuicServer</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>                <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Token</span><span class=p>:</span>                 <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Users</span><span class=p>:</span>                 <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Certificate</span><span class=p>:</span>           <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>PrivateKey</span><span class=p>:</span>            <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Listen</span><span class=p>:</span>                <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>CongestionController</span><span class=p>:</span>  <span class=s>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>MaxIdleTime</span><span class=p>:</span>           <span class=mi>15000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>AuthenticationTimeout</span><span class=p>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>ALPN</span><span class=p>:</span>                  <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;h3&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>MaxUdpRelayPacketSize</span><span class=p>:</span> <span class=mi>1500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>EBpf</span><span class=p>:</span> <span class=nx>EBpf</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>RedirectToTun</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>AutoRedir</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>IPTables</span><span class=p>:</span> <span class=nx>IPTables</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>           <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>InboundInterface</span><span class=p>:</span> <span class=s>&#34;lo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Bypass</span><span class=p>:</span>           <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>DNS</span><span class=p>:</span> <span class=nx>RawDNS</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>       <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>IPv6</span><span class=p>:</span>         <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>UseHosts</span><span class=p>:</span>     <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>IPv6Timeout</span><span class=p>:</span>  <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>EnhancedMode</span><span class=p>:</span> <span class=nx>C</span><span class=p>.</span><span class=nx>DNSMapping</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>FakeIPRange</span><span class=p>:</span>  <span class=s>&#34;198.18.0.1/16&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>FallbackFilter</span><span class=p>:</span> <span class=nx>RawFallbackFilter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoIP</span><span class=p>:</span>     <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoIPCode</span><span class=p>:</span> <span class=s>&#34;CN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>IPCIDR</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoSite</span><span class=p>:</span>   <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>DefaultNameserver</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;114.114.114.114&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;223.5.5.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;8.8.8.8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;1.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>NameServer</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;&lt;https://doh.pub/dns-query&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;tls://223.5.5.5:853&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>FakeIPFilter</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;dns.msftnsci.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;www.msftnsci.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;www.msftconnecttest.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Sniffer</span><span class=p>:</span> <span class=nx>RawSniffer</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>          <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>Sniffing</span><span class=p>:</span>        <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>ForceDomain</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>SkipDomain</span><span class=p>:</span>      <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>Ports</span><span class=p>:</span>           <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=nx>ForceDnsMapping</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>ParsePureIp</span><span class=p>:</span>     <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>OverrideDest</span><span class=p>:</span>    <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Profile</span><span class=p>:</span> <span class=nx>Profile</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>StoreSelected</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>GeoXUrl</span><span class=p>:</span> <span class=nx>RawGeoXUrl</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Mmdb</span><span class=p>:</span>    <span class=s>&#34;&lt;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>GeoIp</span><span class=p>:</span>   <span class=s>&#34;&lt;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>GeoSite</span><span class=p>:</span> <span class=s>&#34;&lt;https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>yaml</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>buf</span><span class=p>,</span> <span class=nx>rawCfg</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>rawCfg</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dnsmode-alias>DNSMode Alias</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=nx>DNSMode</span><span class=p>)</span> <span class=nf>String</span><span class=p>()</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span> <span class=nx>e</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>DNSNormal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;normal&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>DNSFakeIP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;fake-ip&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>DNSMapping</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;redir-host&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>DNSHosts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;hosts&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;unknown&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=type-rawdns-struct>type RawDNS struct</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>RawDNS</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Enable</span>                <span class=kt>bool</span>              <span class=s>`yaml:&#34;enable&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>PreferH3</span>              <span class=kt>bool</span>              <span class=s>`yaml:&#34;prefer-h3&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>IPv6</span>                  <span class=kt>bool</span>              <span class=s>`yaml:&#34;ipv6&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>IPv6Timeout</span>           <span class=kt>uint</span>              <span class=s>`yaml:&#34;ipv6-timeout&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>UseHosts</span>              <span class=kt>bool</span>              <span class=s>`yaml:&#34;use-hosts&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>NameServer</span>            <span class=p>[]</span><span class=kt>string</span>          <span class=s>`yaml:&#34;nameserver&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Fallback</span>              <span class=p>[]</span><span class=kt>string</span>          <span class=s>`yaml:&#34;fallback&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>FallbackFilter</span>        <span class=nx>RawFallbackFilter</span> <span class=s>`yaml:&#34;fallback-filter&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Listen</span>                <span class=kt>string</span>            <span class=s>`yaml:&#34;listen&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>EnhancedMode</span>          <span class=nx>C</span><span class=p>.</span><span class=nx>DNSMode</span>         <span class=s>`yaml:&#34;enhanced-mode&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>FakeIPRange</span>           <span class=kt>string</span>            <span class=s>`yaml:&#34;fake-ip-range&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>FakeIPFilter</span>          <span class=p>[]</span><span class=kt>string</span>          <span class=s>`yaml:&#34;fake-ip-filter&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>DefaultNameserver</span>     <span class=p>[]</span><span class=kt>string</span>          <span class=s>`yaml:&#34;default-nameserver&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>NameServerPolicy</span>      <span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=nx>any</span>    <span class=s>`yaml:&#34;nameserver-policy&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>ProxyServerNameserver</span> <span class=p>[]</span><span class=kt>string</span>          <span class=s>`yaml:&#34;proxy-server-nameserver&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=dns-é»˜è®¤é…ç½®>DNS é»˜è®¤é…ç½®</h4><p><a class=link href=https://github.com/MetaCubeX/Clash.Meta/blob/8d1251f1287846daf42db4151b707d9f677be5a1/config/config.go#L377 target=_blank rel=noopener>Clash.Meta/config/config.go MetaCubeX/Clash.Meta</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>DNS</span><span class=p>:</span> <span class=nx>RawDNS</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Enable</span><span class=p>:</span>       <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>IPv6</span><span class=p>:</span>         <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>UseHosts</span><span class=p>:</span>     <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>IPv6Timeout</span><span class=p>:</span>  <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>EnhancedMode</span><span class=p>:</span> <span class=nx>C</span><span class=p>.</span><span class=nx>DNSMapping</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>FakeIPRange</span><span class=p>:</span>  <span class=s>&#34;198.18.0.1/16&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>FallbackFilter</span><span class=p>:</span> <span class=nx>RawFallbackFilter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoIP</span><span class=p>:</span>     <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoIPCode</span><span class=p>:</span> <span class=s>&#34;CN&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>IPCIDR</span><span class=p>:</span>    <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>				<span class=nx>GeoSite</span><span class=p>:</span>   <span class=p>[]</span><span class=kt>string</span><span class=p>{},</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>DefaultNameserver</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;114.114.114.114&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;223.5.5.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;8.8.8.8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;1.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>NameServer</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;&lt;https://doh.pub/dns-query&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;tls://223.5.5.5:853&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>FakeIPFilter</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;dns.msftnsci.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;www.msftnsci.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;www.msftconnecttest.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=type-pool-struct>type Pool struct</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Pool is an implementation about fake ip generator without storage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Pool</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>gateway</span> <span class=nx>netip</span><span class=p>.</span><span class=nx>Addr</span>
</span></span><span class=line><span class=cl>	<span class=nx>first</span>   <span class=nx>netip</span><span class=p>.</span><span class=nx>Addr</span>
</span></span><span class=line><span class=cl>	<span class=nx>last</span>    <span class=nx>netip</span><span class=p>.</span><span class=nx>Addr</span>
</span></span><span class=line><span class=cl>	<span class=nx>offset</span>  <span class=nx>netip</span><span class=p>.</span><span class=nx>Addr</span>
</span></span><span class=line><span class=cl>	<span class=nx>cycle</span>   <span class=kt>bool</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span>     <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl>	<span class=nx>host</span>    <span class=o>*</span><span class=nx>trie</span><span class=p>.</span><span class=nx>DomainTrie</span><span class=p>[</span><span class=kd>struct</span><span class=p>{}]</span>
</span></span><span class=line><span class=cl>	<span class=nx>ipnet</span>   <span class=o>*</span><span class=nx>netip</span><span class=p>.</span><span class=nx>Prefix</span>
</span></span><span class=line><span class=cl>	<span class=nx>store</span>   <span class=nx>store</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=geositegeoip-å¤§å°å†™ä¸æ•æ„Ÿ>GEOSITEï¼ŒGEOIP å¤§å°å†™ä¸æ•æ„Ÿ</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// å°†å›½å®¶ä»£ç è½¬æˆå°å†™åå†åŒ¹é…
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>LoadGeoSiteMatcher</span><span class=p>(</span><span class=nx>countryCode</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>--</span> <span class=nx>skip</span> <span class=o>--</span>
</span></span><span class=line><span class=cl>	<span class=nx>countryCode</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>ToLower</span><span class=p>(</span><span class=nx>countryCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>--</span> <span class=nx>skip</span> <span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// LAN ç‰¹ä¾‹ï¼Œå¿…é¡»å¤§å†™æ‰èƒ½åŒ¹é…è§„åˆ™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>LoadGeoIPMatcher</span><span class=p>(</span><span class=nx>country</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>--</span> <span class=nx>skip</span> <span class=o>--</span>
</span></span><span class=line><span class=cl>	<span class=nx>country</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>ToLower</span><span class=p>(</span><span class=nx>country</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>--</span> <span class=nx>skip</span> <span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ---
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>countryCode</span> <span class=p>=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>ToLower</span><span class=p>(</span><span class=nx>countryCode</span><span class=p>)</span> 
</span></span></code></pre></td></tr></table></div></div><p>æ¢å¥è¯è¯´ï¼Œä»¥ä¸‹å†™æ³•æ˜¯ç­‰ä»·çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>GEOSITE,PRIVATE,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>GEOSITE,private,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>GEOIP,cn,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span>- <span class=l>GEOIP,CN,DIRECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># ä»¥æ­¤ç±»æ¨</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=new-tuic>new tuic</h4><p><a class=link href=https://github.com/MetaCubeX/Clash.Meta/blob/0b1aff575990ea5816cd24b64757b75dc7368db1/adapter/outbound/tuic.go#L120 target=_blank rel=noopener>NewTuic MetaCubeX/Clash.Meta</a></p><h3 id=å¸¸è§é—®é¢˜æ±‡æ€»>å¸¸è§é—®é¢˜æ±‡æ€»</h3><ol><li>Windows DNS ç­–ç•¥ç»„é—®é¢˜</li><li>ä½¿ç”¨ clash ä¸€é¡¿æ“ä½œè¿ä¸ä¸Šå…¬å¸å†…ç½‘</li></ol><h2 id=reference>Reference</h2><ul><li><a class=link href=https://github.com/Loyalsoldier/clash-rules#rule-providers-%e9%85%8d%e7%bd%ae%e6%96%b9%e5%bc%8f target=_blank rel=noopener>è§„åˆ™ä¸Šæ¸¸</a></li><li><a class=link href=https://wiki.metacubex.one/config/rules/rule-provider/#rule-set target=_blank rel=noopener>è¯­æ³•è§„åˆ™</a></li><li><a class=link href=https://wiki.metacubex.one/config/dns/diagram/ target=_blank rel=noopener>Clash.Meta çš„ DNS å·¥ä½œæµç¨‹</a></li><li><a class=link href=https://wiki.metacubex.one/config/dns/#nameserver-policy target=_blank rel=noopener>åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ç­–ç•¥</a></li><li><a class=link href=https://www.dnsperf.com/ target=_blank rel=noopener>å…¨çƒå…¬æœ‰DNSæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/clash/>Clash</a>
<a href=/tags/clash-meta/>clash-meta</a>
<a href=/tags/clash-verge/>clash-verge</a>
<a href=/tags/clash-dns/>clash-dns</a>
<a href=/tags/dns-router/>dns-router</a>
<a href=/tags/fakeip/>fakeip</a>
<a href=/tags/fakedns/>fakedns</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-views><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye-check" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="2"/><path d="M12 19c-4 0-7.333-2.333-10-7 2.667-4.667 6-7 10-7s7.333 2.333 10 7c-.42.736-.858 1.414-1.311 2.033"/><path d="M15 19l2 2 4-4"/></svg><span id=busuanzi_value_page_pv><i class="fa fa-spinner fa-spin"></i></span><span>&nbsp;&nbsp;views</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title></h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/mouting-alidrive-locally/><div class=article-image><img src=/p/mouting-alidrive-locally/doharge-08.27fe05f80783b2afc1a99ae30afbef9a_hu13fdd9666faf8189fe2265e8a87a6e60_2048497_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post ã€Blogã€Mounting Alidrive Locally" data-key=mouting-alidrive-locally data-hash="md5-J/4F+AeDsq/BqZrjCvvvmg=="></div><div class=article-details><h2 class=article-title>ã€Blogã€Mounting Alidrive Locally</h2></div></a></article><article class=has-image><a href=/p/nezha-monitoring/><div class=article-image><img src=/p/nezha-monitoring/wanderer4.9bee2fe0cbce8e6561efb26acbc637c4_huf18331c9a1d279d8d1eb1f131ae90b4b_1493237_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post ã€Blogã€NeZha Monitoring ä»ä¸€åˆ°æ— ç©·å¤§" data-key=nezha-monitoring data-hash="md5-m+4v4MvOjmVh77Jqy8Y3xA=="></div><div class=article-details><h2 class=article-title>ã€Blogã€NeZha Monitoring ä»ä¸€åˆ°æ— ç©·å¤§</h2></div></a></article><article class=has-image><a href=/p/google-research-seanet-musiclm/><div class=article-image><img src=/p/google-research-seanet-musiclm/lixin.6532f3b9036b287abd9baa6e6ffbf0f7_hu108383160588985e40f4f4076326a6a7_370693_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post ã€Blogã€AI æœ‰æœ›æˆä¸ºåè¯­ä¹å›çš„ä¸‹ä¸€ä»»å‘¨æ°ä¼¦" data-key=google-research-seanet-musiclm data-hash="md5-ZTLzuQNrKHq9m6pub/vw9w=="></div><div class=article-details><h2 class=article-title>ã€Blogã€AI æœ‰æœ›æˆä¸ºåè¯­ä¹å›çš„ä¸‹ä¸€ä»»å‘¨æ°ä¼¦</h2></div></a></article><article class=has-image><a href=/p/chatgpt-antirules/><div class=article-image><img src=/p/chatgpt-antirules/naifan-zhang-4.0c5815704d7dbbc2bfe51f3c0db101fe_hu3e631bccb1a1bbdefca010a85222fc9f_376773_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post ã€Blogã€ChatGPT Anti Rules" data-key=chatgpt-antirules data-hash="md5-DFgVcE19u8K/5R88DbEB/g=="></div><div class=article-details><h2 class=article-title>ã€Blogã€ChatGPT Anti Rules</h2></div></a></article><article class=has-image><a href=/p/chatgpt-register/><div class=article-image><img src=/p/chatgpt-register/lixin.23c0d1f4ab1eeefa1421bfb4ab576d11_hub61807a84e13a72e03127d9d91db1097_437671_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post ã€Blogã€è·³å‡ºä¼ ç»Ÿï¼ŒChatGPT å¸¦ä½ ç©è½¬æ™ºèƒ½å¯¹è¯" data-key=chatgpt-register data-hash="md5-I8DR9Kse7voUIb+0q1dtEQ=="></div><div class=article-details><h2 class=article-title>ã€Blogã€è·³å‡ºä¼ ç»Ÿï¼ŒChatGPT å¸¦ä½ ç©è½¬æ™ºèƒ½å¯¹è¯</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=qin2dim/blog-comments issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Echosec @QIN2DIM</section><section class=powerby>You will to enjoy grander sight / By climing to a greater height.<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.12.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ç®€ä»‹>ç®€ä»‹</a></li><li><a href=#å®éªŒç¯å¢ƒ>å®éªŒç¯å¢ƒ</a></li><li><a href=#å®éªŒæ–¹æ³•>å®éªŒæ–¹æ³•</a></li><li><a href=#é…ç½®ç¯‡>é…ç½®ç¯‡</a><ol><li><a href=#å¼•å…¥-default-nameserver--nameserver>å¼•å…¥ default-nameserver & nameserver</a><ol><li><a href=#è§„åˆ™æ¨¡å¼---å¯¹ç…§ç»„--é»˜è®¤é…ç½®>è§„åˆ™æ¨¡å¼ - å¯¹ç…§ç»„ | é»˜è®¤é…ç½®</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-dns-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DNS IP</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-doh-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DOH: IP</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-ä¸º-doh-domain>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver</em> ä¸º DOH: domain</a></li></ol></li><li><a href=#å¼•å…¥-namesever-policy>å¼•å…¥ namesever-policy</a><ol><li><a href=#è§„åˆ™æ¨¡å¼---åŒæ—¶è®¾ç½®-nameserver-policy-å’Œ-nameserver>è§„åˆ™æ¨¡å¼ - åŒæ—¶è®¾ç½® <em>nameserver-policy</em> å’Œ <em>nameserver</em></a></li><li><a href=#è§„åˆ™æ¨¡å¼---æ··ç”¨-doh>è§„åˆ™æ¨¡å¼ - æ··ç”¨ DOH</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-policy-ä¸º-doh-ip>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver-policy</em> ä¸º DOH: IP</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ä»…è®¾ç½®-nameserver-policy-ä¸º-doh-domain>è§„åˆ™æ¨¡å¼ - ä»…è®¾ç½® <em>nameserver-policy</em> ä¸º DOH: domain</a></li></ol></li><li><a href=#å¼•å…¥-dns-åˆ†æµ>å¼•å…¥ DNS åˆ†æµ</a><ol><li><a href=#è§„åˆ™æ¨¡å¼---åŸŸåè§„åˆ™çš„è§£æ>è§„åˆ™æ¨¡å¼ - åŸŸåè§„åˆ™çš„è§£æ</a></li><li><a href=#è§„åˆ™æ¨¡å¼---åŸŸåè§„åˆ™çš„è§£æ---éªŒè¯>è§„åˆ™æ¨¡å¼ - åŸŸåè§„åˆ™çš„è§£æ - éªŒè¯</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ---åŸç†å‰–æ>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ - åŸç†å‰–æğŸ´â€â˜ ï¸</a></li><li><a href=#è§„åˆ™æ¨¡å¼---ip-è§„åˆ™çš„è§£æ---éªŒè¯>è§„åˆ™æ¨¡å¼ - IP è§„åˆ™çš„è§£æ - éªŒè¯</a></li><li><a href=#å…¨å±€æ¨¡å¼---å…¨å±€ä»£ç†å…¨å±€ç›´è¿ä¸å…¨å±€æ‹’ç»>å…¨å±€æ¨¡å¼ - å…¨å±€ä»£ç†ï¼Œå…¨å±€ç›´è¿ä¸å…¨å±€æ‹’ç»</a></li><li><a href=#public-dns---å·²çŸ¥çš„-dns-æä¾›å•†>Public DNS - å·²çŸ¥çš„ DNS æä¾›å•†</a></li></ol></li></ol></li><li><a href=#åŸç†ç¯‡>åŸç†ç¯‡</a><ol><li><a href=#clash-flow---dns>Clash flow - DNS</a></li><li><a href=#clash-flow---proxy>Clash flow - Proxy</a></li></ol></li><li><a href=#æ³„æ¼ç¯‡>æ³„æ¼ç¯‡</a><ol><li><a href=#dns-æ³„æ¼---æ¦‚å¿µç•Œå®š>DNS æ³„æ¼ - æ¦‚å¿µç•Œå®š</a></li><li><a href=#dns-æ³„æ¼---äº‰è®®ç‚¹>DNS æ³„æ¼ - äº‰è®®ç‚¹</a><ol><li><a href=#vpn-çš„-dns-æ³„æ¼>VPN çš„ DNS æ³„æ¼</a></li><li><a href=#proxy-çš„-dns-æ³„æ¼>Proxy çš„ DNS æ³„æ¼</a></li></ol></li><li><a href=#dns-æ³„æ¼---æ£€æµ‹å·¥å…·>DNS æ³„æ¼ - æ£€æµ‹å·¥å…·</a></li><li><a href=#dns-æ³„æ¼---æ£€æµ‹åŸç†>DNS æ³„æ¼ - æ£€æµ‹åŸç†</a></li><li><a href=#å¦‚ä½•é¿å…-dns-æ³„æ¼>å¦‚ä½•é¿å… DNS æ³„æ¼</a></li></ol></li><li><a href=#è§¦ç±»æ—é€š>è§¦ç±»æ—é€š</a><ol><li><a href=#tunnel-mode>TUNNEL Mode</a></li><li><a href=#enhanced-mode>Enhanced Mode</a><ol><li><a href=#dnsmaping>DNSMaping</a></li><li><a href=#fakeip-clash--meta>FakeIP: Clash & Meta</a></li><li><a href=#fakedns-v2ray--sing-box>FakeDNS: v2ray & sing-box</a></li><li><a href=#l3-loss-but-deepin-magic>L3: Loss but deepin magic</a></li></ol></li><li><a href=#è½¯è·¯ç”±---ç‰©ç†è¶…åº¦>è½¯è·¯ç”± - ç‰©ç†è¶…åº¦</a></li></ol></li><li><a href=#ä¸€å¶çŸ¥ç§‹>ä¸€å¶çŸ¥ç§‹</a><ol><li><a href=#å¤„ç†-squad-eac-åå¤–æŒ‚éªŒè¯>å¤„ç† Squad EAC åå¤–æŒ‚éªŒè¯</a></li><li><a href=#è§£é”æµåª’ä½“>è§£é”æµåª’ä½“</a></li><li><a href=#ç»•è¿‡-chatgpt-ç½‘ç»œå®¡æŸ¥>ç»•è¿‡ ChatGPT ç½‘ç»œå®¡æŸ¥</a></li></ol></li><li><a href=#å¤©å¤–é£ä»™>å¤©å¤–é£ä»™</a><ol><li><a href=#åŸºäº-rust-å®ç°-pbq-quic-based-æ‹¥å¡æ§åˆ¶ç®—æ³•>åŸºäº Rust å®ç° PBQ QUIC-based æ‹¥å¡æ§åˆ¶ç®—æ³•</a></li></ol></li><li><a href=#clashmeta-å‚è€ƒé…ç½®>Clash.Meta å‚è€ƒé…ç½®</a></li><li><a href=#whats-more>What&rsquo;s more</a><ol><li><a href=#æœ¯è¯­è¡¨>æœ¯è¯­è¡¨</a></li><li><a href=#æºç é˜…è¯»>æºç é˜…è¯»</a><ol><li><a href=#åˆå§‹åŒ–é…ç½®>åˆå§‹åŒ–é…ç½®</a></li><li><a href=#dnsmode-alias>DNSMode Alias</a></li><li><a href=#type-rawdns-struct>type RawDNS struct</a></li><li><a href=#dns-é»˜è®¤é…ç½®>DNS é»˜è®¤é…ç½®</a></li><li><a href=#type-pool-struct>type Pool struct</a></li><li><a href=#geositegeoip-å¤§å°å†™ä¸æ•æ„Ÿ>GEOSITEï¼ŒGEOIP å¤§å°å†™ä¸æ•æ„Ÿ</a></li><li><a href=#new-tuic>new tuic</a></li></ol></li><li><a href=#å¸¸è§é—®é¢˜æ±‡æ€»>å¸¸è§é—®é¢˜æ±‡æ€»</a></li></ol></li><li><a href=#reference>Reference</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>